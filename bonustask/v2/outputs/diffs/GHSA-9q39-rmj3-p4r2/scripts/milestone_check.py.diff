--- scripts\milestone_check.py (old)
+++ scripts\milestone_check.py (new)
@@ -1,4 +1,4 @@
-# Copyright (c) Jupyter Development Team.
+# Copyright (c) 2018 Jupyter Development Team.
 # Distributed under the terms of the Modified BSD License.
 
 # Generate a GitHub token at https://github.com/settings/tokens
@@ -26,7 +26,7 @@
     "2.1": "origin/2.1.x --not origin/2.0.x",
     "2.2": "origin/2.2.x --not origin/2.1.x",
     # 6507205805 is a commit in the debugger ancestor tree before merging
-    "3.0": "origin/main ^origin/2.2.x ^6507205805",
+    "3.0": "origin/master ^origin/2.2.x ^6507205805",
 }
 
 try:
@@ -35,27 +35,27 @@
     print(
         "Error: set the environment variable GITHUB_TOKEN to a GitHub authentication token (see https://github.com/settings/tokens)"
     )
-    sys.exit(1)
-
-if len(sys.argv) != 2:  # noqa
+    exit(1)
+
+if len(sys.argv) != 2:
     print("Error: exactly one argument expected, the milestone.")
-    sys.exit(1)
+    exit(1)
 
 MILESTONE = sys.argv[1]
 
 if MILESTONE not in ranges:
     print(
-        f"Error: I do not know about milestone {MILESTONE!r}. Possible milestones are {list(ranges.keys())!r}"
-    )
-    sys.exit(1)
+        "Error: I do not know about milestone %r. Possible milestones are %r"
+        % (MILESTONE, list(ranges.keys()))
+    )
+    exit(1)
 
 
 out = subprocess.run(
-    f"git log {ranges[MILESTONE]} --format='%H,%cE,%s'",
-    shell=True,  # noqa S602
+    "git log {} --format='%H,%cE,%s'".format(ranges[MILESTONE]),
+    shell=True,
     encoding="utf8",
     stdout=subprocess.PIPE,
-    check=True,
 )
 commits = {i[0]: (i[1], i[2]) for i in (x.split(",", 2) for x in out.stdout.splitlines())}
 
@@ -102,19 +102,19 @@
 cursor = None
 while True:
     json["variables"]["cursor"] = cursor
-    r = requests.post(url=url, json=json, headers=headers, timeout=120)
+    r = requests.post(url=url, json=json, headers=headers)
     results = r.json()["data"]["search"]
     total_prs = results["issueCount"]
 
     pr_list = results["nodes"]
     for pr in pr_list:
-        if pr["commits"]["totalCount"] > 100:  # noqa
+        if pr["commits"]["totalCount"] > 100:
             large_prs.append(pr["number"])
             continue
             # TODO fetch commits
         prs[pr["number"]] = {
             "mergeCommit": pr["mergeCommit"]["oid"],
-            "commits": {i["commit"]["oid"] for i in pr["commits"]["nodes"]},
+            "commits": set(i["commit"]["oid"] for i in pr["commits"]["nodes"]),
         }
 
     has_next_page = results["pageInfo"]["hasNextPage"]
@@ -156,9 +156,9 @@
     prjson["variables"]["pr"] = prnumber
     pr_commits = set()
     while True:
-        r = requests.post(url=url, json=prjson, headers=headers, timeout=120)
+        r = requests.post(url=url, json=prjson, headers=headers)
         pr = r.json()["data"]["repository"]["pullRequest"]
-        assert pr["number"] == prnumber  # noqa
+        assert pr["number"] == prnumber
         total_commits = pr["commits"]["totalCount"]
         pr_commits.update(i["commit"]["oid"] for i in pr["commits"]["nodes"])
         has_next_page = results["pageInfo"]["hasNextPage"]
@@ -177,7 +177,7 @@
 
 
 # Check we got all PRs
-assert len(prs) == total_prs  # noqa
+assert len(prs) == total_prs
 
 # Reverse dictionary
 commits_to_prs = {}
@@ -206,7 +206,7 @@
 if len(prs_not_represented) > 0:
     print(
         """
-PRs that are in the milestone, but have no commits in the version range.
+PRs that are in the milestone, but have no commits in the version range. 
 These PRs probably belong in a different milestone.
 """
     )
@@ -228,10 +228,10 @@
     print(
         """The following commits are not included in any PR on this milestone.
 This probably means the commit's PR needs to be assigned to this milestone,
-or the commit was pushed to main directly.
+or the commit was pushed to master directly.
 """
     )
-    print("\n".join(f"{c} {commits[c][0]} {commits[c][1]}" for c in notfound))
+    print("\n".join("%s %s %s" % (c, commits[c][0], commits[c][1]) for c in notfound))
     prs_to_check = [
         c
         for c in notfound
@@ -243,7 +243,7 @@
             "Try checking these PRs. They probably should be in the milestone, but probably aren't:"
         )
         print()
-        print("\n".join(f"{c} {commits[c][1]}" for c in prs_to_check))
+        print("\n".join("%s %s" % (c, commits[c][1]) for c in prs_to_check))
 else:
     print(
         "Congratulations! All commits in the commit history are included in some PR in this milestone."