--- buildutils\src\patch-release.ts (old)
+++ buildutils\src\patch-release.ts (new)
@@ -3,7 +3,7 @@
 | Distributed under the terms of the Modified BSD License.
 |----------------------------------------------------------------------------*/
 
-import { program as commander } from 'commander';
+import commander from 'commander';
 import * as utils from './utils';
 
 // Specify the program signature.
@@ -13,7 +13,7 @@
   .option('--all', 'Patch all JS packages instead of the changed ones')
   .option('--skip-commit', 'Whether to skip commit changes')
   .action((options: any) => {
-    utils.exitOnUncaughtException();
+    utils.exitOnUuncaughtException();
 
     // Make sure we can patch release.
     const pyVersion = utils.getPythonVersion();
@@ -29,25 +29,38 @@
     utils.prebump();
 
     // Version the changed
-    let cmd = `lerna version patch --no-git-tag-version --no-push`;
+    let cmd = `lerna version patch -m \"[ci skip] New version\" --no-push`;
     if (options.all) {
       cmd += ' --force-publish=*';
     }
     if (options.force) {
       cmd += ' --yes';
     }
-
-    const oldVersion = utils.getJSVersion('metapackage');
+    const oldVersion = utils.run(
+      'git rev-parse HEAD',
+      {
+        stdio: 'pipe',
+        encoding: 'utf8'
+      },
+      true
+    );
     utils.run(cmd);
-    const newVersion = utils.getJSVersion('metapackage');
-
+    const newVersion = utils.run(
+      'git rev-parse HEAD',
+      {
+        stdio: 'pipe',
+        encoding: 'utf8'
+      },
+      true
+    );
     if (oldVersion === newVersion) {
+      console.debug('aborting');
       // lerna didn't version anything, so we assume the user aborted
       throw new Error('Lerna aborted');
     }
 
     // Patch the python version
-    utils.run('bumpversion patch --allow-dirty'); // switches to alpha
+    utils.run('bumpversion patch'); // switches to alpha
     utils.run('bumpversion release --allow-dirty'); // switches to beta
     utils.run('bumpversion release --allow-dirty'); // switches to rc.
     utils.run('bumpversion release --allow-dirty'); // switches to final.