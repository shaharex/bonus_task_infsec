--- jupyterlab\semver.py (old)
+++ jupyterlab\semver.py (new)
@@ -1,6 +1,4 @@
-# Copyright (c) Jupyter Development Team.
-# Distributed under the terms of the Modified BSD License.
-
+# -*- coding:utf-8 -*-
 # This file comes from https://github.com/podhmo/python-semver/blob/b42e9896e391e086b773fc621b23fa299d16b874/semver/__init__.py
 #
 # It is licensed under the following license:
@@ -35,10 +33,14 @@
 
 SEMVER_SPEC_VERSION = "2.0.0"
 
-string_type = str
-
-
-class _R:
+# Python 2/3 compatibility
+try:
+    string_type = basestring
+except NameError:
+    string_type = str
+
+
+class _R(object):
     def __init__(self, i):
         self.i = i
 
@@ -312,9 +314,9 @@
 
 # version name recovery for convenient
 RECOVERYVERSIONNAME = R()
-_n = src[NUMERICIDENTIFIER]
-_pre = src[PRERELEASELOOSE]
-src[RECOVERYVERSIONNAME] = f"v?({_n})(?:\\.({_n}))?{_pre}?"
+src[RECOVERYVERSIONNAME] = "v?({n})(?:\\.({n}))?{pre}?".format(
+    n=src[NUMERICIDENTIFIER], pre=src[PRERELEASELOOSE]
+)
 
 #  Compile to actual regexp objects.
 #  All are flag-free, unless they were created above with a flag.
@@ -325,7 +327,10 @@
 
 
 def parse(version, loose):
-    r = regexp[LOOSE] if loose else regexp[FULL]
+    if loose:
+        r = regexp[LOOSE]
+    else:
+        r = regexp[FULL]
     m = r.search(version)
     if m:
         return semver(version, loose)
@@ -349,7 +354,7 @@
         return None
 
 
-NUMERIC = re.compile(r"^\d+$")
+NUMERIC = re.compile("^\d+$")
 
 
 def semver(version, loose):
@@ -359,7 +364,7 @@
         else:
             version = version.version
     elif not isinstance(version, string_type):  # xxx:
-        raise ValueError(f"Invalid Version: {version}")
+        raise ValueError("Invalid Version: {}".format(version))
 
     """
     if (!(this instanceof SemVer))
@@ -371,7 +376,7 @@
 make_semver = semver
 
 
-class SemVer:
+class SemVer(object):
     def __init__(self, version, loose):
         logger.debug("SemVer %s, %s", version, loose)
         self.loose = loose
@@ -380,7 +385,7 @@
         m = regexp[LOOSE if loose else FULL].search(version.strip())
         if not m:
             if not loose:
-                raise ValueError(f"Invalid Version: {version}")
+                raise ValueError("Invalid Version: {}".format(version))
             m = regexp[RECOVERYVERSIONNAME].search(version.strip())
             self.major = int(m.group(1)) if m.group(1) else 0
             self.minor = int(m.group(2)) if m.group(2) else 0
@@ -389,7 +394,7 @@
                 self.prerelease = []
             else:
                 self.prerelease = [
-                    (int(id_) if NUMERIC.search(id_) else id_) for id_ in m.group(3).split(".")
+                    (int(id) if NUMERIC.search(id) else id) for id in m.group(3).split(".")
                 ]
         else:
             #  these are actually numbers
@@ -400,8 +405,9 @@
             if not m.group(4):
                 self.prerelease = []
             else:
+
                 self.prerelease = [
-                    (int(id_) if NUMERIC.search(id_) else id_) for id_ in m.group(4).split(".")
+                    (int(id) if NUMERIC.search(id) else id) for id in m.group(4).split(".")
                 ]
             if m.group(5):
                 self.build = m.group(5).split(".")
@@ -411,13 +417,13 @@
         self.format()  # xxx:
 
     def format(self):
-        self.version = f"{self.major}.{self.minor}.{self.patch}"
+        self.version = "{}.{}.{}".format(self.major, self.minor, self.patch)
         if len(self.prerelease) > 0:
             self.version += "-{}".format(".".join(str(v) for v in self.prerelease))
         return self.version
 
     def __repr__(self):
-        return f"<SemVer {self} >"
+        return "<SemVer {} >".format(self)
 
     def __str__(self):
         return self.version
@@ -440,7 +446,7 @@
             or compare_identifiers(str(self.patch), str(other.patch))
         )
 
-    def compare_pre(self, other):  # noqa PLR0911
+    def compare_pre(self, other):
         if not isinstance(other, SemVer):
             other = make_semver(other, self.loose)
 
@@ -472,7 +478,7 @@
             else:
                 return compare_identifiers(str(a), str(b))
 
-    def inc(self, release, identifier=None):  # noqa PLR0915
+    def inc(self, release, identifier=None):
         logger.debug("inc release %s %s", self.prerelease, release)
         if release == "premajor":
             self.prerelease = []
@@ -550,7 +556,7 @@
                 else:
                     self.prerelease = [identifier, 0]
         else:
-            raise ValueError(f"invalid increment argument: {release}")
+            raise ValueError("invalid increment argument: {}".format(release))
         self.format()
         self.raw = self.version
         return self
@@ -604,11 +610,11 @@
     def key_function(version):
         v = make_semver(version, loose)
         key = (v.major, v.minor, v.patch)
-        if v.prerelease:  # noqa SIM108
+        if v.prerelease:
             key = key + tuple(v.prerelease)
         else:
             #  NOT having a prerelease is > having one
-            key = (*key, float("inf"))
+            key = key + (float("inf"),)
 
         return key
 
@@ -619,16 +625,16 @@
 full_key_function = make_key_function(True)
 
 
-def sort(list_, loose):
+def sort(list, loose):
     keyf = loose_key_function if loose else full_key_function
-    list_.sort(key=keyf)
-    return list_
-
-
-def rsort(list_, loose):
+    list.sort(key=keyf)
+    return list
+
+
+def rsort(list, loose):
     keyf = loose_key_function if loose else full_key_function
-    list_.sort(key=keyf, reverse=True)
-    return list_
+    list.sort(key=keyf, reverse=True)
+    return list
 
 
 def gt(a, b, loose):
@@ -655,7 +661,7 @@
     return compare(a, b, loose) <= 0
 
 
-def cmp(a, op, b, loose):  # noqa PLR0911
+def cmp(a, op, b, loose):
     logger.debug("cmp: %s", op)
     if op == "===":
         return a == b
@@ -674,7 +680,7 @@
     elif op == "<=":
         return lte(a, b, loose)
     else:
-        raise ValueError(f"Invalid operator: {op}")
+        raise ValueError("Invalid operator: {}".format(op))
 
 
 def comparator(comp, loose):
@@ -694,7 +700,7 @@
 ANY = object()
 
 
-class Comparator:
+class Comparator(object):
     semver = None
 
     def __init__(self, comp, loose):
@@ -708,12 +714,15 @@
             self.value = self.operator + self.semver.version
 
     def parse(self, comp):
-        r = regexp[COMPARATORLOOSE] if self.loose else regexp[COMPARATOR]
+        if self.loose:
+            r = regexp[COMPARATORLOOSE]
+        else:
+            r = regexp[COMPARATOR]
         logger.debug("parse comp=%s", comp)
         m = r.search(comp)
 
         if m is None:
-            raise ValueError(f"Invalid comparator: {comp}")
+            raise ValueError("Invalid comparator: {}".format(comp))
 
         self.operator = m.group(1)
         # if it literally is just '>' or '' then allow anything.
@@ -723,7 +732,7 @@
             self.semver = semver(m.group(2), self.loose)
 
     def __repr__(self):
-        return f'<SemVer Comparator "{self}">'
+        return '<SemVer Comparator "{}">'.format(self)
 
     def __str__(self):
         return self.value
@@ -745,7 +754,7 @@
     return Range(range_, loose)
 
 
-class Range:
+class Range(object):
     def __init__(self, range_, loose):
         self.loose = loose
         #  First, split based on boolean or ||
@@ -754,12 +763,12 @@
         self.set = [r for r in xs if r]
 
         if not len(self.set):
-            raise ValueError(f"Invalid SemVer Range: {range_}")
+            raise ValueError("Invalid SemVer Range: {}".format(range_))
 
         self.format()
 
     def __repr__(self):
-        return f'<SemVer Range "{self.range}">'
+        return '<SemVer Range "{}">'.format(self.range)
 
     def format(self):
         self.range = "||".join(
@@ -775,7 +784,10 @@
         loose = self.loose
         logger.debug("range %s %s", range_, loose)
         #  `1.2.3 - 1.2.4` => `>=1.2.3 <=1.2.4`
-        hr = regexp[HYPHENRANGELOOSE] if loose else regexp[HYPHENRANGE]
+        if loose:
+            hr = regexp[HYPHENRANGELOOSE]
+        else:
+            hr = regexp[HYPHENRANGE]
 
         range_ = hr.sub(
             hyphen_replace,
@@ -794,13 +806,16 @@
         range_ = regexp[CARETTRIM].sub(caretTrimReplace, range_)
 
         #  normalize spaces
-        range_ = " ".join(re.split(r"\s+", range_))
+        range_ = " ".join(re.split("\s+", range_))
 
         #  At this point, the range is completely trimmed and
         #  ready to be split into comparators.
-        comp_re = regexp[COMPARATORLOOSE] if loose else regexp[COMPARATOR]
+        if loose:
+            comp_re = regexp[COMPARATORLOOSE]
+        else:
+            comp_re = regexp[COMPARATOR]
         set_ = re.split(
-            r"\s+", " ".join([parse_comparator(comp, loose) for comp in range_.split(" ")])
+            "\s+", " ".join([parse_comparator(comp, loose) for comp in range_.split(" ")])
         )
         if self.loose:
             # in loose mode, throw out any that are not valid comparators
@@ -815,7 +830,10 @@
         if isinstance(version, string_type):
             version = make_semver(version, loose=self.loose)
 
-        return any(test_set(e, version) for e in self.set)
+        for e in self.set:
+            if test_set(e, version):
+                return True
+        return False
 
 
 #  Mostly just for testing and legacy API reasons
@@ -844,8 +862,8 @@
     return comp
 
 
-def is_x(id_):
-    return id_ is None or id_ == "" or id_.lower() == "x" or id_ == "*"
+def is_x(id):
+    return id is None or id == "" or id.lower() == "x" or id == "*"
 
 
 #  ~, ~> --> * (any, kinda silly)
@@ -857,11 +875,14 @@
 
 
 def replace_tildes(comp, loose):
-    return " ".join([replace_tilde(c, loose) for c in re.split(r"\s+", comp.strip())])
+    return " ".join([replace_tilde(c, loose) for c in re.split("\s+", comp.strip())])
 
 
 def replace_tilde(comp, loose):
-    r = regexp[TILDELOOSE] if loose else regexp[TILDE]
+    if loose:
+        r = regexp[TILDELOOSE]
+    else:
+        r = regexp[TILDE]
 
     def repl(mob):
         _ = mob.group(0)
@@ -895,13 +916,16 @@
 #  ^1.2.3 --> >=1.2.3 <2.0.0
 #  ^1.2.0 --> >=1.2.0 <2.0.0
 def replace_carets(comp, loose):
-    return " ".join([replace_caret(c, loose) for c in re.split(r"\s+", comp.strip())])
+    return " ".join([replace_caret(c, loose) for c in re.split("\s+", comp.strip())])
 
 
 def replace_caret(comp, loose):
-    r = regexp[CARETLOOSE] if loose else regexp[CARET]
-
-    def repl(mob):  # noqa PLR0911
+    if loose:
+        r = regexp[CARETLOOSE]
+    else:
+        r = regexp[CARET]
+
+    def repl(mob):
         m0 = mob.group(0)
         M, m, p, pr, _ = mob.groups()
         logger.debug("caret %s %s %s %s %s %s", comp, m0, M, m, p, pr)
@@ -909,10 +933,10 @@
         if is_x(M):
             ret = ""
         elif is_x(m):
-            ret = ">=" + M + ".0.0 <" + str(int(M) + 1) + ".0.0"
+            ret = ">=" + M + ".0.0 <" + str((int(M) + 1)) + ".0.0"
         elif is_x(p):
             if M == "0":
-                ret = ">=" + M + "." + m + ".0 <" + M + "." + str(int(m) + 1) + ".0"
+                ret = ">=" + M + "." + m + ".0 <" + M + "." + str((int(m) + 1)) + ".0"
             else:
                 ret = ">=" + M + "." + m + ".0 <" + str(int(M) + 1) + ".0.0"
         elif pr:
@@ -981,7 +1005,7 @@
                         + " <"
                         + M
                         + "."
-                        + str(int(m) + 1)
+                        + str((int(m) + 1))
                         + ".0"
                     )
             else:
@@ -994,14 +1018,17 @@
 
 def replace_xranges(comp, loose):
     logger.debug("replaceXRanges %s %s", comp, loose)
-    return " ".join([replace_xrange(c, loose) for c in re.split(r"\s+", comp.strip())])
+    return " ".join([replace_xrange(c, loose) for c in re.split("\s+", comp.strip())])
 
 
 def replace_xrange(comp, loose):
     comp = comp.strip()
-    r = regexp[XRANGELOOSE] if loose else regexp[XRANGE]
-
-    def repl(mob):  # noqa PLR0911
+    if loose:
+        r = regexp[XRANGELOOSE]
+    else:
+        r = regexp[XRANGE]
+
+    def repl(mob):
         ret = mob.group(0)
         gtlt, M, m, p, pr, _ = mob.groups()
 
@@ -1017,7 +1044,7 @@
 
         logger.debug("xrange gtlt=%s any_x=%s", gtlt, any_x)
         if xM:
-            if gtlt == ">" or gtlt == "<":  # noqa SIM108
+            if gtlt == ">" or gtlt == "<":
                 # nothing is allowed
                 ret = "<0.0.0"
             else:
@@ -1128,7 +1155,7 @@
 def satisfies(version, range_, loose=False):
     try:
         range_ = make_range(range_, loose)
-    except Exception:
+    except Exception as e:
         return False
     return range_.test(version)
 
@@ -1136,12 +1163,12 @@
 def max_satisfying(versions, range_, loose=False):
     try:
         range_ob = make_range(range_, loose=loose)
-    except Exception:
+    except:
         return None
     max_ = None
     max_sv = None
     for v in versions:
-        if range_ob.test(v):  # noqa  # satisfies(v, range_, loose=loose)
+        if range_ob.test(v):  # satisfies(v, range_, loose=loose)
             if max_ is None or max_sv.compare(v) == -1:  # compare(max, v, true)
                 max_ = v
                 max_sv = make_semver(max_, loose=loose)
@@ -1153,7 +1180,7 @@
         #  Return '*' instead of '' so that truthiness works.
         #  This will throw if it's invalid anyway
         return make_range(range_, loose).range or "*"
-    except Exception:
+    except:
         return None
 
 
@@ -1212,7 +1239,7 @@
 
     #  If the lowest version comparator has an operator and our version
     #  is less than it then it isn't higher than the range
-    if (not low.operator or low.operator == comp) and ltefn(version, low.semver):  # noqa SIM114
+    if (not low.operator or low.operator == comp) and ltefn(version, low.semver):
         return False
     elif low.operator == ecomp and ltfn(version, low.semver):
         return False