--- galata\src\utils.ts (old)
+++ galata\src\utils.ts (new)
@@ -2,7 +2,7 @@
 // Distributed under the terms of the Modified BSD License.
 
 import { URLExt } from '@jupyterlab/coreutils';
-import { ElementHandle, Locator, Page } from '@playwright/test';
+import { ElementHandle, Page } from '@playwright/test';
 import * as fs from 'fs-extra';
 import * as path from 'path';
 
@@ -76,8 +76,6 @@
  *
  * @param element Element handle
  * @returns Classes list
- *
- * @deprecated You should use locator instead {@link getLocatorClassList}
  */
 export async function getElementClassList(
   element: ElementHandle
@@ -92,21 +90,6 @@
     if (typeof classNameList === 'string') {
       return classNameList.split(' ');
     }
-  }
-
-  return [];
-}
-
-/**
- * Get the classes of an locator
- *
- * @param locator Element locator
- * @returns Classes list
- */
-export async function getLocatorClassList(locator: Locator): Promise<string[]> {
-  const className = await locator.getAttribute('class');
-  if (className) {
-    return className.split(/\s/);
   }
 
   return [];
@@ -186,7 +169,7 @@
         }
         resolve();
       } else {
-        checkTimer = setTimeout(check, 50);
+        checkTimer = setTimeout(check, 200);
       }
     };
 
@@ -212,37 +195,23 @@
  */
 export async function waitForTransition(
   page: Page,
-  element: ElementHandle<Element> | Locator | string
+  element: ElementHandle<Element> | string
 ): Promise<void> {
-  let el = typeof element === 'string' ? page.locator(element) : element;
-  try {
-    return (el as Locator).evaluate(elem => {
+  const el = typeof element === 'string' ? await page.$(element) : element;
+
+  if (el) {
+    return page.evaluate(el => {
       return new Promise(resolve => {
         const onEndHandler = () => {
-          elem.removeEventListener('transitionend', onEndHandler);
+          el.removeEventListener('transitionend', onEndHandler);
           resolve();
         };
-        elem.addEventListener('transitionend', onEndHandler);
+        el.addEventListener('transitionend', onEndHandler);
       });
-    });
-  } catch {
-    if (el) {
-      console.warn(
-        'ElementHandle are deprecated, you should call "WaitForTransition()" \
-        with a Locator instead'
-      );
-      return page.evaluate(el => {
-        return new Promise(resolve => {
-          const onEndHandler = () => {
-            el.removeEventListener('transitionend', onEndHandler);
-            resolve();
-          };
-          el.addEventListener('transitionend', onEndHandler);
-        });
-      }, el as ElementHandle<Element>);
-    }
-    return Promise.reject();
-  }
+    }, el);
+  }
+
+  return Promise.reject();
 }
 
 // Selector builders
@@ -252,8 +221,6 @@
  *
  * @param className Class name
  * @returns Selector
- *
- * @deprecated You should use locator CSS selector `locator('.className')`
  */
 export function xpContainsClass(className: string): string {
   return `contains(concat(" ", normalize-space(@class), " "), " ${className} ")`;
@@ -264,11 +231,9 @@
  *
  * @param name Activity name
  * @returns Selector
- *
- * @deprecated You should use locator selector `getByRole('main').getByRole('tab', { name })`
  */
 export function xpBuildActivityTabSelector(name: string): string {
-  return `//div[contains(@role, "main")]//ul/li[${xpContainsClass(
+  return `//div[${xpContainsClass('jp-Activity')}]/ul/li[${xpContainsClass(
     'lm-TabBar-tab'
   )} and ./div[text()="${name}" and ${xpContainsClass('lm-TabBar-tabLabel')}]]`;
 }
@@ -278,9 +243,6 @@
  *
  * @param id Activity id
  * @returns Selector
- *
- * @deprecated You should use locator selector `getByRole('main').getByRole('tabpanel', { name })`
- *   where `name` is the name of the tab.
  */
 export function xpBuildActivityPanelSelector(id: string): string {
   return `//div[@id='${id}' and ${xpContainsClass(
@@ -292,21 +254,11 @@
  * Get the selector to look for the currently active activity tab
  *
  * @returns Selector
- *
- * @deprecated You should use locator selector `getByRole('main').locator('.jp-mod-current[role="tab"]')`
  */
 export function xpBuildActiveActivityTabSelector(): string {
-  return `//div[contains(@role, "main")]//ul/li[${xpContainsClass(
+  return `//div[${xpContainsClass('jp-Activity')}]/ul/li[${xpContainsClass(
     'lm-TabBar-tab'
-  )} and ${xpContainsClass('jp-mod-current')} and ./div[${xpContainsClass(
+  )} and ${xpContainsClass('lm-mod-current')} and ./div[${xpContainsClass(
     'lm-TabBar-tabLabel'
   )}]]`;
 }
-
-/**
- * Whether JupyterLab is in simple mode or not
- */
-export function isInSimpleMode(page: Page): Promise<boolean> {
-  const toggle = page.getByRole('switch', { name: 'Simple' });
-  return toggle.isChecked();
-}