--- galata\src\jupyterlabpage.ts (old)
+++ galata\src\jupyterlabpage.ts (new)
@@ -1,14 +1,11 @@
 // Copyright (c) Jupyter Development Team.
 // Distributed under the terms of the Modified BSD License.
 
-import type { Notification } from '@jupyterlab/apputils';
-import type { ISettingRegistry } from '@jupyterlab/settingregistry';
-import type { ElementHandle, Locator, Page, Response } from '@playwright/test';
+import type { ElementHandle, Page, Response } from '@playwright/test';
+import * as path from 'path';
 import { ContentsHelper } from './contents';
-import type { IPluginNameToInterfaceMap } from './extension';
 import {
   ActivityHelper,
-  DebuggerHelper,
   FileBrowserHelper,
   KernelHelper,
   LogConsoleHelper,
@@ -17,7 +14,6 @@
   PerformanceHelper,
   SidebarHelper,
   StatusBarHelper,
-  StyleHelper,
   ThemeHelper
 } from './helpers';
 import * as Utils from './utils';
@@ -67,11 +63,6 @@
   readonly notebook: NotebookHelper;
 
   /**
-   * JupyterLab notifications
-   */
-  readonly notifications: Promise<Notification.INotification[]>;
-
-  /**
    * Webbrowser performance helpers
    */
   readonly performance: PerformanceHelper;
@@ -84,30 +75,14 @@
    */
   readonly sidebar: SidebarHelper;
   /**
-   * JupyterLab style helpers
-   */
-  readonly style: StyleHelper;
-  /**
    * JupyterLab theme helpers
    */
   readonly theme: ThemeHelper;
 
   /**
-   * JupyterLab launcher tab
-   */
-  readonly launcher: Locator;
-
-  /**
    * Selector for launcher tab
-   *
-   * @deprecated You should use locator selector {@link launcher}
    */
   readonly launcherSelector: string;
-
-  /**
-   * Debugger helper
-   */
-  readonly debugger: DebuggerHelper;
 
   /**
    * Getter for JupyterLab base URL
@@ -187,9 +162,8 @@
        * - `'domcontentloaded'` - consider operation to be finished when the `DOMContentLoaded` event is fired.
        * - `'load'` - consider operation to be finished when the `load` event is fired.
        * - `'networkidle'` - consider operation to be finished when there are no network connections for at least `500` ms.
-       * - `'commit'` - consider operation to be finished when network response is received and the document started loading.
        */
-      waitUntil?: 'load' | 'domcontentloaded' | 'networkidle' | 'commit';
+      waitUntil?: 'load' | 'domcontentloaded' | 'networkidle';
     }
   ): Promise<Response | null>;
 
@@ -212,7 +186,7 @@
   setSimpleMode(simple: boolean): Promise<boolean>;
 
   /**
-   * Wait for a condition to be fulfilled
+   * Wait for a  condition to be fulfilled
    *
    * @param condition Condition to fulfill
    * @param timeout Maximal time to wait for the condition to be true
@@ -227,16 +201,12 @@
    *
    * @param element Element or selector to watch
    */
-  waitForTransition(
-    element: ElementHandle<Element> | Locator | string
-  ): Promise<void>;
+  waitForTransition(element: ElementHandle<Element> | string): Promise<void>;
 
   /**
    * Factory for active activity tab xpath
    *
    * @returns The selector
-   *
-   * @deprecated You should use locator selector `getByRole('main').locator('.jp-mod-current[role="tab"]')`
    */
   xpBuildActiveActivityTabSelector(): string;
 
@@ -244,9 +214,6 @@
    * Factory for activity panel xpath by id
    * @param id Panel id
    * @returns The selector
-   *
-   * @deprecated You should use locator selector `getByRole('main').getByRole('tabpanel', { name })`
-   *   where `name` is the name of the tab.
    */
   xpBuildActivityPanelSelector(id: string): string;
 
@@ -255,8 +222,6 @@
    *
    * @param name Activity name
    * @returns The selector
-   *
-   * @deprecated You should use locator selector `getByRole('main').getByRole('tab', { name })`
    */
   xpBuildActivityTabSelector(name: string): string;
 
@@ -265,8 +230,6 @@
    *
    * @param className Class name
    * @returns The selector
-   *
-   * @deprecated You should use locator CSS selector `locator('.className')`
    */
   xpContainsClass(className: string): string;
 }
@@ -291,7 +254,7 @@
   ) {
     this.waitIsReady = waitForApplication;
     this.activity = new ActivityHelper(page);
-    this.contents = new ContentsHelper(page.context().request, page);
+    this.contents = new ContentsHelper(baseURL, page, page.context().request);
     this.filebrowser = new FileBrowserHelper(page, this.contents);
     this.kernel = new KernelHelper(page);
     this.logconsole = new LogConsoleHelper(page);
@@ -306,9 +269,7 @@
     this.performance = new PerformanceHelper(page);
     this.statusbar = new StatusBarHelper(page, this.menu);
     this.sidebar = new SidebarHelper(page, this.menu);
-    this.style = new StyleHelper(page);
     this.theme = new ThemeHelper(page);
-    this.debugger = new DebuggerHelper(page, this.sidebar, this.notebook);
   }
 
   /**
@@ -347,13 +308,6 @@
   readonly notebook: NotebookHelper;
 
   /**
-   * JupyterLab notifications
-   */
-  get notifications(): Promise<Notification.INotification[]> {
-    return this.page.evaluate(async () => window.galata.getNotifications());
-  }
-
-  /**
    * Webbrowser performance helpers
    */
   readonly performance: PerformanceHelper;
@@ -367,33 +321,13 @@
    * JupyterLab sidebar helpers
    */
   readonly sidebar: SidebarHelper;
-
-  /**
-   * JupyterLab style helpers
-   */
-  readonly style: StyleHelper;
-
   /**
    * JupyterLab theme helpers
    */
   readonly theme: ThemeHelper;
 
   /**
-   * JupyterLab debugger helper
-   */
-  readonly debugger: DebuggerHelper;
-
-  /**
-   * JupyterLab launcher tab
-   */
-  get launcher(): Locator {
-    return this.activity.launcher;
-  }
-
-  /**
    * Selector for launcher tab
-   *
-   * @deprecated You should use locator selector {@link launcher}
    */
   get launcherSelector(): string {
     return this.activity.launcherSelector;
@@ -507,9 +441,14 @@
   /**
    * Whether JupyterLab is in simple mode or not
    */
-  isInSimpleMode(): Promise<boolean> {
-    return Utils.isInSimpleMode(this.page);
-  }
+  isInSimpleMode = async (): Promise<boolean> => {
+    const toggle = await this.page.$(
+      '#jp-single-document-mode button.jp-switch'
+    );
+    const checked = (await toggle?.getAttribute('aria-checked')) === 'true';
+
+    return checked;
+  };
 
   /**
    * Returns the main resource response. In case of multiple redirects, the navigation will resolve with the response of the
@@ -574,20 +513,8 @@
     await this.kernel.shutdownAll();
     // show status bar
     await this.statusbar.show();
-    // Reset the layout
-    await this.page.evaluate(
-      async ({ pluginId }) => {
-        const settingRegistry = (await window.galata.getPlugin(
-          pluginId
-        )) as ISettingRegistry;
-        const SHELL_ID = '@jupyterlab/application-extension:shell';
-        await settingRegistry.remove(SHELL_ID, 'layout');
-      },
-      {
-        pluginId:
-          '@jupyterlab/apputils-extension:settings' as keyof IPluginNameToInterfaceMap
-      }
-    );
+    // make sure all sidebar tabs are on left
+    await this.sidebar.moveAllTabsToLeft();
     // show Files tab on sidebar
     await this.sidebar.openTab('filebrowser');
     // go to home folder
@@ -601,7 +528,7 @@
    * @returns Whether this operation succeeds or not
    */
   async setSimpleMode(simple: boolean): Promise<boolean> {
-    const toggle = this.page.locator(
+    const toggle = await this.page.$(
       '#jp-single-document-mode button.jp-switch'
     );
     if (toggle) {
@@ -642,15 +569,13 @@
    * @param element Element or selector to watch
    */
   async waitForTransition(
-    element: ElementHandle<Element> | Locator | string
+    element: ElementHandle<Element> | string
   ): Promise<void> {
     return Utils.waitForTransition(this.page, element);
   }
 
   /**
    * Factory for active activity tab xpath
-   *
-   * @deprecated You should use locator selector `getByRole('main').locator('.jp-mod-current[role="tab"]')`
    */
   xpBuildActiveActivityTabSelector(): string {
     return Utils.xpBuildActiveActivityTabSelector();
@@ -659,9 +584,6 @@
   /**
    * Factory for activity panel xpath by id
    * @param id Panel id
-   *
-   * @deprecated You should use locator selector `getByRole('main').getByRole('tabpanel', { name })`
-   *   where `name` is the name of the tab.
    */
   xpBuildActivityPanelSelector(id: string): string {
     return Utils.xpBuildActivityPanelSelector(id);
@@ -670,8 +592,6 @@
   /**
    * Factory for activity tab xpath by name
    * @param name Activity name
-   *
-   * @deprecated You should use locator selector `getByRole('main').getByRole('tab', { name })`
    */
   xpBuildActivityTabSelector(name: string): string {
     return Utils.xpBuildActivityTabSelector(name);
@@ -680,8 +600,6 @@
   /**
    * Factory for element containing a given class xpath
    * @param className Class name
-   *
-   * @deprecated You should use locator CSS selector `locator('.className')`
    */
   xpContainsClass(className: string): string {
     return Utils.xpContainsClass(className);
@@ -691,17 +609,21 @@
    * Inject the galata in-page helpers
    */
   protected async hookHelpersUp(): Promise<void> {
-    // Check galata helpers are loaded
+    // Insert Galata in page helpers
+    await this.page.addScriptTag({
+      path: path.resolve(__dirname, './lib-inpage/inpage.js')
+    });
+
     const galataipDefined = await this.page.evaluate(() => {
-      return Promise.resolve(typeof window.galata === 'object');
+      return Promise.resolve(typeof window.galataip === 'object');
     });
 
     if (!galataipDefined) {
-      throw new Error('Failed to activate galata extension');
+      throw new Error('Failed to inject galataip object into browser context');
     }
 
     const jlabAccessible = await this.page.evaluate(() => {
-      return Promise.resolve(typeof window.galata.app === 'object');
+      return Promise.resolve(typeof window.galataip.app === 'object');
     });
 
     if (!jlabAccessible) {
@@ -715,7 +637,11 @@
   protected waitForAppStarted = async (): Promise<void> => {
     return this.waitForCondition(() =>
       this.page.evaluate(async () => {
-        if (typeof window.jupyterapp === 'object') {
+        if (typeof window.jupyterlab === 'object') {
+          // Wait for plugins to be loaded
+          await window.jupyterlab.started;
+          return true;
+        } else if (typeof window.jupyterapp === 'object') {
           // Wait for plugins to be loaded
           await window.jupyterapp.started;
           return true;