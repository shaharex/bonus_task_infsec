--- galata\test\jupyterlab\settings.test.ts (old)
+++ galata\test\jupyterlab\settings.test.ts (new)
@@ -1,8 +1,8 @@
 // Copyright (c) Jupyter Development Team.
 // Distributed under the terms of the Modified BSD License.
 
-import { IJupyterLabPageFixture, test } from '@jupyterlab/galata';
-import { expect, Locator } from '@playwright/test';
+import { test } from '@jupyterlab/galata';
+import { expect } from '@playwright/test';
 
 test('Open the settings editor with a specific search query', async ({
   page
@@ -14,79 +14,63 @@
   });
 
   expect(
-    await page
-      .locator('.jp-PluginList jp-search')
-      .evaluate(elem => (elem as any).value)
+    await page.locator('.jp-PluginList .jp-FilterBox input').inputValue()
   ).toEqual('Command Palette');
 
   await expect(page.locator('.jp-SettingsForm')).toHaveCount(1);
-
-  const pluginList = page.locator('.jp-PluginList');
-
-  expect(await pluginList.screenshot()).toMatchSnapshot(
-    'settings-plugin-list.png'
-  );
-
-  const settingsPanel = page.locator('.jp-SettingsPanel');
-
-  expect(await settingsPanel.screenshot()).toMatchSnapshot(
-    'settings-panel.png'
-  );
 });
 
 test.describe('change font-size', () => {
   const ipynbFileName = 'create_test.ipynb';
 
-  const createNewCodeCell = async (page: IJupyterLabPageFixture) => {
+  const createNewCodeCell = async page => {
     await page.notebook.createNew(ipynbFileName);
     await page.notebook.addCell('code', '2 + 2');
   };
-  const createMarkdownFile = async (page: IJupyterLabPageFixture) => {
-    await page.locator('div[role="main"] >> text=Launcher').waitFor();
+  const createMarkdownFile = async page => {
+    await page.waitForSelector('div[role="main"] >> text=Launcher');
     await page.click('.jp-LauncherCard[title="Create a new markdown file"]');
-    await page.locator('.jp-FileEditor .cm-content').waitFor();
-    return page.locator('.jp-FileEditor .cm-content');
+    return await page.waitForSelector('.jp-FileEditor .CodeMirror-code');
   };
-  const inputMarkdownFile = async (
-    page: IJupyterLabPageFixture,
-    markdownFile: Locator
-  ) => {
+  const inputMarkdownFile = async (page, markdownFile) => {
     await markdownFile.focus();
-    await markdownFile.pressSequentially('markdown cell');
+    await markdownFile.type('markdown cell');
     await page.keyboard.press('Control');
     await page.keyboard.press('s');
   };
-  const getCodeCellFontSize = async (page: IJupyterLabPageFixture) => {
-    const cellElement = page.locator(
-      'div.lm-Widget.jp-Cell.jp-CodeCell.jp-Notebook-cell.jp-mod-noOutputs.jp-mod-active.jp-mod-selected .cm-line'
+  const getCodeCellFontSize = async page => {
+    const cellElement = await page.$(
+      'div.lm-Widget.jp-Cell.jp-CodeCell.jp-Notebook-cell.jp-mod-noOutputs.jp-mod-active.jp-mod-selected .CodeMirror-line'
     );
-    const computedStyle = await cellElement.evaluate(el =>
-      getComputedStyle(el)
+    const computedStyle = await page.evaluate(
+      el => getComputedStyle(el),
+      cellElement
     );
     return parseInt(computedStyle.fontSize);
   };
-  const getMarkdownFontSize = async (page: IJupyterLabPageFixture) => {
-    const markdownElement = page.locator('.jp-RenderedHTMLCommon');
-    await markdownElement.waitFor();
-    const computedStyle = await markdownElement.evaluate(el =>
-      getComputedStyle(el)
+  const getMarkdownFontSize = async page => {
+    await page.waitForSelector('.jp-RenderedHTMLCommon');
+    const markdownElement = await page.$('.jp-RenderedHTMLCommon');
+    const computedStyle = await page.evaluate(
+      el => getComputedStyle(el),
+      markdownElement
     );
     return parseInt(computedStyle.fontSize);
   };
-  const getFileListFontSize = async (page: IJupyterLabPageFixture) => {
-    const itemElement = page.locator(
+  const getFileListFontSize = async page => {
+    await page.waitForSelector(
       '.jp-DirListing-content .jp-DirListing-itemText'
     );
-    await itemElement.waitFor();
-    const computedStyle = await itemElement.evaluate(el =>
-      getComputedStyle(el)
+    const itemElement = await page.$(
+      '.jp-DirListing-content .jp-DirListing-itemText'
+    );
+    const computedStyle = await page.evaluate(
+      el => getComputedStyle(el),
+      itemElement
     );
     return parseInt(computedStyle.fontSize);
   };
-  const changeCodeFontSize = async (
-    page: IJupyterLabPageFixture,
-    menuOption
-  ) => {
+  const changeCodeFontSize = async (page, menuOption) => {
     await page.click('text=Settings');
     await page.click('.lm-Menu ul[role="menu"] >> text=Theme');
     await page.click(`.lm-Menu ul[role="menu"] >> text="${menuOption}"`);
@@ -97,14 +81,15 @@
     const fontSize = await getCodeCellFontSize(page);
     await changeCodeFontSize(page, 'Increase Code Font Size');
 
-    await page.locator('div[role="main"] >> text=Launcher').waitFor();
-    await page.locator('.jp-Notebook-cell').first().waitFor();
+    await page.waitForSelector('div[role="main"] >> text=Launcher');
+    await page.waitForSelector('.jp-Notebook-cell');
 
-    const cellElement = page.locator(
-      'div.lm-Widget.jp-Cell.jp-CodeCell.jp-Notebook-cell.jp-mod-noOutputs.jp-mod-active.jp-mod-selected .cm-line'
+    const cellElement = await page.$(
+      'div.lm-Widget.jp-Cell.jp-CodeCell.jp-Notebook-cell.jp-mod-noOutputs.jp-mod-active.jp-mod-selected .CodeMirror-line'
     );
-    const computedStyle = await cellElement.evaluate(el =>
-      getComputedStyle(el)
+    const computedStyle = await page.evaluate(
+      el => getComputedStyle(el),
+      cellElement
     );
     expect(computedStyle.fontSize).toEqual(`${fontSize + 1}px`);
   });
@@ -114,14 +99,15 @@
     const fontSize = await getCodeCellFontSize(page);
     await changeCodeFontSize(page, 'Decrease Code Font Size');
 
-    await page.locator('div[role="main"] >> text=Launcher').waitFor();
-    await page.locator('.jp-Notebook-cell').first().waitFor();
+    await page.waitForSelector('div[role="main"] >> text=Launcher');
+    await page.waitForSelector('.jp-Notebook-cell');
 
-    const cellElement = page.locator(
-      'div.lm-Widget.jp-Cell.jp-CodeCell.jp-Notebook-cell.jp-mod-noOutputs.jp-mod-active.jp-mod-selected .cm-line'
+    const cellElement = await page.$(
+      'div.lm-Widget.jp-Cell.jp-CodeCell.jp-Notebook-cell.jp-mod-noOutputs.jp-mod-active.jp-mod-selected .CodeMirror-line'
     );
-    const computedStyle = await cellElement.evaluate(el =>
-      getComputedStyle(el)
+    const computedStyle = await page.evaluate(
+      el => getComputedStyle(el),
+      cellElement
     );
     expect(computedStyle.fontSize).toEqual(`${fontSize - 1}px`);
   });
@@ -130,16 +116,17 @@
     const markdownFile = await createMarkdownFile(page);
     await inputMarkdownFile(page, markdownFile);
     await page.evaluate(() => {
-      return window.galata.app.commands.execute('fileeditor:markdown-preview');
+      return window.jupyterapp.commands.execute('fileeditor:markdown-preview');
     });
     const fontSize = await getMarkdownFontSize(page);
 
     await changeCodeFontSize(page, 'Increase Content Font Size');
 
-    await page.locator('.jp-FileEditor .cm-content').waitFor();
-    const fileElement = page.locator('.jp-RenderedHTMLCommon');
-    const computedStyle = await fileElement.evaluate(el =>
-      getComputedStyle(el)
+    await page.waitForSelector('.jp-FileEditor .CodeMirror-code');
+    const fileElement = await page.$('.jp-RenderedHTMLCommon');
+    const computedStyle = await page.evaluate(
+      el => getComputedStyle(el),
+      fileElement
     );
     expect(computedStyle.fontSize).toEqual(`${fontSize + 1}px`);
   });
@@ -148,16 +135,17 @@
     const markdownFile = await createMarkdownFile(page);
     await inputMarkdownFile(page, markdownFile);
     await page.evaluate(() => {
-      return window.galata.app.commands.execute('fileeditor:markdown-preview');
+      return window.jupyterapp.commands.execute('fileeditor:markdown-preview');
     });
     const fontSize = await getMarkdownFontSize(page);
 
     await changeCodeFontSize(page, 'Decrease Content Font Size');
 
-    await page.locator('.jp-FileEditor .cm-content').waitFor();
-    const fileElement = page.locator('.jp-RenderedHTMLCommon');
-    const computedStyle = await fileElement.evaluate(el =>
-      getComputedStyle(el)
+    await page.waitForSelector('.jp-FileEditor .CodeMirror-code');
+    const fileElement = await page.$('.jp-RenderedHTMLCommon');
+    const computedStyle = await page.evaluate(
+      el => getComputedStyle(el),
+      fileElement
     );
     expect(computedStyle.fontSize).toEqual(`${fontSize - 1}px`);
   });
@@ -167,14 +155,15 @@
     const fontSize = await getFileListFontSize(page);
     await changeCodeFontSize(page, 'Increase UI Font Size');
 
-    await page
-      .locator('.jp-DirListing-content .jp-DirListing-itemText')
-      .waitFor();
-    const fileElement = page.locator(
+    await page.waitForSelector(
       '.jp-DirListing-content .jp-DirListing-itemText'
     );
-    const computedStyle = await fileElement.evaluate(el =>
-      getComputedStyle(el)
+    const fileElement = await page.$(
+      '.jp-DirListing-content .jp-DirListing-itemText'
+    );
+    const computedStyle = await page.evaluate(
+      el => getComputedStyle(el),
+      fileElement
     );
     expect(computedStyle.fontSize).toEqual(`${fontSize + 1}px`);
   });
@@ -184,69 +173,16 @@
     const fontSize = await getFileListFontSize(page);
     await changeCodeFontSize(page, 'Decrease UI Font Size');
 
-    await page
-      .locator('.jp-DirListing-content .jp-DirListing-itemText')
-      .waitFor();
-    const fileElement = page.locator(
+    await page.waitForSelector(
       '.jp-DirListing-content .jp-DirListing-itemText'
     );
-    const computedStyle = await fileElement.evaluate(el =>
-      getComputedStyle(el)
+    const fileElement = await page.$(
+      '.jp-DirListing-content .jp-DirListing-itemText'
+    );
+    const computedStyle = await page.evaluate(
+      el => getComputedStyle(el),
+      fileElement
     );
     expect(computedStyle.fontSize).toEqual(`${fontSize - 1}px`);
   });
 });
-
-test('Check codemirror settings can all be set at the same time.', async ({
-  page
-}) => {
-  await page.evaluate(async () => {
-    await window.jupyterapp.commands.execute('settingeditor:open', {
-      query: 'CodeMirror'
-    });
-  });
-
-  await expect(page.locator('.jp-SettingsForm')).toHaveCount(1);
-
-  const textList: Array<string> = [
-    'Code Folding',
-    'Highlight the active line',
-    'Highlight trailing white space',
-    'Highlight white space'
-  ];
-  let locators: Locator[] = [];
-  for (const selectText of textList) {
-    let locator = page.getByLabel(selectText);
-    await locator.click();
-    locators.push(locator);
-  }
-  for (const locator of locators) {
-    await expect(locator).toBeChecked();
-  }
-});
-
-test('Opening Keyboard Shortcuts settings does not mangle user shortcuts', async ({
-  page
-}) => {
-  // Testing against https://github.com/jupyterlab/jupyterlab/issues/12056
-  await page.evaluate(async () => {
-    await window.jupyterapp.commands.execute('settingeditor:open', {
-      query: 'Keyboard Shortcuts'
-    });
-  });
-
-  await expect(page.locator('.jp-SettingsForm')).toHaveCount(1);
-
-  await page.evaluate(async () => {
-    await window.jupyterapp.commands.execute('settingeditor:open-json');
-  });
-
-  await expect(page.locator('#json-setting-editor')).toHaveCount(1);
-  await page.click(
-    '#json-setting-editor .jp-PluginList-entry[data-id="@jupyterlab/shortcuts-extension:shortcuts"]'
-  );
-  const userPanelLines = await page
-    .locator('.jp-SettingsRawEditor-user .cm-line')
-    .count();
-  expect(userPanelLines).toBeLessThan(10);
-});