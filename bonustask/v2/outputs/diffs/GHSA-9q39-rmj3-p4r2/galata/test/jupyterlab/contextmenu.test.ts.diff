--- galata\test\jupyterlab\contextmenu.test.ts (old)
+++ galata\test\jupyterlab\contextmenu.test.ts (new)
@@ -15,8 +15,8 @@
 });
 
 test.describe('Application Context Menu', () => {
-  test.beforeAll(async ({ request, tmpPath }) => {
-    const contents = galata.newContentsHelper(request);
+  test.beforeAll(async ({ baseURL, request, tmpPath }) => {
+    const contents = galata.newContentsHelper(baseURL, undefined, request);
 
     // Create some dummy content
     await contents.uploadFile(
@@ -42,8 +42,8 @@
     await page.filebrowser.openHomeDirectory();
   });
 
-  test.afterAll(async ({ request, tmpPath }) => {
-    const contents = galata.newContentsHelper(request);
+  test.afterAll(async ({ baseURL, request, tmpPath }) => {
+    const contents = galata.newContentsHelper(baseURL, undefined, request);
     await contents.deleteDirectory(tmpPath);
   });
 
@@ -59,7 +59,7 @@
     expect(await page.menu.isAnyOpen()).toBe(true);
 
     const imageName = 'folder.png';
-    const menu = await page.menu.getOpenMenuLocator();
+    const menu = await page.menu.getOpenMenu();
     expect(await menu.screenshot()).toMatchSnapshot(imageName);
   });
 
@@ -74,7 +74,7 @@
     expect(await page.menu.isAnyOpen()).toBe(true);
 
     const imageName = 'file.png';
-    const menu = await page.menu.getOpenMenuLocator();
+    const menu = await page.menu.getOpenMenu();
     expect(await menu.screenshot()).toMatchSnapshot(imageName);
   });
 
@@ -84,9 +84,9 @@
   }) => {
     await page.notebook.openByPath(`${tmpPath}/${testNotebook}`);
     // Wait for kernel to be idle
-    await expect(
-      page.locator(`#jp-main-statusbar >> text=Idle`).first()
-    ).toHaveCount(1);
+    expect(
+      await page.waitForSelector(`#jp-main-statusbar >> text=Idle`)
+    ).toBeTruthy();
 
     await page.click(`.jp-DirListing-item span:has-text("${testNotebook}")`, {
       button: 'right'
@@ -95,7 +95,7 @@
     expect(await page.menu.isAnyOpen()).toBe(true);
 
     const imageName = 'running-notebook.png';
-    const menu = await page.menu.getOpenMenuLocator();
+    const menu = await page.menu.getOpenMenu();
     expect(await menu.screenshot()).toMatchSnapshot(imageName);
   });
 
@@ -110,13 +110,11 @@
     expect(await page.menu.isAnyOpen()).toBe(true);
 
     await page.hover('text=Open With');
-    await page
-      .locator('.lm-Menu li[role="menuitem"]:has-text("Editor")')
-      .waitFor();
+    await page.waitForSelector('li[role="menuitem"]:has-text("Editor")');
 
     const imageName = `file-openwith.png`;
     // Get the last menu -> will be submenu
-    const menu = await page.menu.getOpenMenuLocator();
+    const menu = await page.menu.getOpenMenu();
 
     expect(await menu.screenshot()).toMatchSnapshot(imageName);
   });
@@ -129,7 +127,7 @@
     expect(await page.menu.isAnyOpen()).toBe(true);
 
     const imageName = `tab-launcher.png`;
-    const menu = await page.menu.getOpenMenuLocator();
+    const menu = await page.menu.getOpenMenu();
     expect(await menu.screenshot()).toMatchSnapshot(imageName);
   });
 
@@ -150,7 +148,7 @@
       expect(await page.menu.isAnyOpen()).toBe(true);
 
       const imageName = `tab-notebook.png`;
-      const menu = await page.menu.getOpenMenuLocator();
+      const menu = await page.menu.getOpenMenu();
       expect(await menu.screenshot()).toMatchSnapshot(imageName);
     });
 
@@ -161,7 +159,7 @@
       expect(await page.menu.isAnyOpen()).toBe(true);
 
       const imageName = `notebook-md.png`;
-      const menu = await page.menu.getOpenMenuLocator();
+      const menu = await page.menu.getOpenMenu();
       expect(await menu.screenshot()).toMatchSnapshot(imageName);
     });
 
@@ -172,7 +170,7 @@
       expect(await page.menu.isAnyOpen()).toBe(true);
 
       const imageName = `notebook-code.png`;
-      const menu = await page.menu.getOpenMenuLocator();
+      const menu = await page.menu.getOpenMenu();
       expect(await menu.screenshot()).toMatchSnapshot(imageName);
     });
   });
@@ -189,33 +187,7 @@
     expect(await page.menu.isAnyOpen()).toBe(true);
 
     const imageName = `fileeditor.png`;
-    const menu = await page.menu.getOpenMenuLocator();
+    const menu = await page.menu.getOpenMenu();
     expect(await menu.screenshot()).toMatchSnapshot(imageName);
   });
-
-  test('Open console context menu', async ({ page }) => {
-    await page.menu.clickMenuItem('File>New>Console');
-    await page.click('button:has-text("Select")');
-
-    await page.locator('[aria-label="Code Cell Content"]').waitFor();
-    await page.locator('text=| Idle').waitFor();
-
-    // Over prompt cell
-    await page.click('.jp-CodeConsole-promptCell', {
-      button: 'right'
-    });
-    expect(await page.menu.isAnyOpen()).toBe(true);
-    let imageName = `console-prompt.png`;
-    let menu = await page.menu.getOpenMenuLocator();
-    expect.soft(await menu?.screenshot()).toMatchSnapshot(imageName);
-
-    // Over console content
-    await page.click('.jp-CodeConsole-content', {
-      button: 'right'
-    });
-    imageName = `console-content.png`;
-    menu = await page.menu.getOpenMenuLocator();
-    expect(await page.menu.isAnyOpen()).toBe(true);
-    expect(await menu?.screenshot()).toMatchSnapshot(imageName);
-  });
 });