--- packages\filebrowser\src\model.ts (old)
+++ packages\filebrowser\src\model.ts (new)
@@ -1,7 +1,7 @@
 // Copyright (c) Jupyter Development Team.
 // Distributed under the terms of the Modified BSD License.
 
-import { Dialog, showDialog } from '@jupyterlab/apputils';
+import { Dialog, IScore, showDialog } from '@jupyterlab/apputils';
 import { IChangedArgs, PageConfig, PathExt } from '@jupyterlab/coreutils';
 import { IDocumentManager, shouldOverwrite } from '@jupyterlab/docmanager';
 import { Contents, KernelSpec, Session } from '@jupyterlab/services';
@@ -11,8 +11,15 @@
   nullTranslator,
   TranslationBundle
 } from '@jupyterlab/translation';
-import { IScore } from '@jupyterlab/ui-components';
-import { ArrayExt, filter } from '@lumino/algorithm';
+import {
+  ArrayExt,
+  ArrayIterator,
+  each,
+  filter,
+  find,
+  IIterator,
+  IterableOrArrayLike
+} from '@lumino/algorithm';
 import { PromiseDelegate, ReadonlyJSONObject } from '@lumino/coreutils';
 import { IDisposable } from '@lumino/disposable';
 import { Poll } from '@lumino/polling';
@@ -96,7 +103,7 @@
         backoff: true,
         max: 300 * 1000
       },
-      standby: options.refreshStandby || 'when-hidden'
+      standby: 'when-hidden'
     });
   }
 
@@ -185,8 +192,8 @@
   /**
    * Create an iterator over the status of all in progress uploads.
    */
-  uploads(): IterableIterator<IUploadModel> {
-    return this._uploads[Symbol.iterator]();
+  uploads(): IIterator<IUploadModel> {
+    return new ArrayIterator(this._uploads);
   }
 
   /**
@@ -209,8 +216,8 @@
    *
    * @returns A new iterator over the model's items.
    */
-  items(): IterableIterator<Contents.IModel> {
-    return this._items[Symbol.iterator]();
+  items(): IIterator<Contents.IModel> {
+    return new ArrayIterator(this._items);
   }
 
   /**
@@ -218,8 +225,8 @@
    *
    * @returns A new iterator over the model's active sessions.
    */
-  sessions(): IterableIterator<Session.IModel> {
-    return this._sessions[Symbol.iterator]();
+  sessions(): IIterator<Session.IModel> {
+    return new ArrayIterator(this._sessions);
   }
 
   /**
@@ -234,19 +241,22 @@
   /**
    * Change directory.
    *
-   * @param path The path to the file or directory.
+   * @param path - The path to the file or directory.
    *
    * @returns A promise with the contents of the directory.
    */
-  async cd(path = '.'): Promise<void> {
-    if (path !== '.') {
-      path = this.manager.services.contents.resolvePath(this._model.path, path);
+  async cd(newValue = '.'): Promise<void> {
+    if (newValue !== '.') {
+      newValue = this.manager.services.contents.resolvePath(
+        this._model.path,
+        newValue
+      );
     } else {
-      path = this._pendingPath || this._model.path;
+      newValue = this._pendingPath || this._model.path;
     }
     if (this._pending) {
       // Collapse requests to the same directory.
-      if (path === this._pendingPath) {
+      if (newValue === this._pendingPath) {
         return this._pending;
       }
       // Otherwise wait for the pending request to complete before continuing.
@@ -254,13 +264,13 @@
     }
     const oldValue = this.path;
     const options: Contents.IFetchOptions = { content: true };
-    this._pendingPath = path;
-    if (oldValue !== path) {
+    this._pendingPath = newValue;
+    if (oldValue !== newValue) {
       this._sessions.length = 0;
     }
     const services = this.manager.services;
     this._pending = services.contents
-      .get(path, options)
+      .get(newValue, options)
       .then(contents => {
         if (this.isDisposed) {
           return;
@@ -268,17 +278,17 @@
         this.handleContents(contents);
         this._pendingPath = null;
         this._pending = null;
-        if (oldValue !== path) {
+        if (oldValue !== newValue) {
           // If there is a state database and a unique key, save the new path.
           // We don't need to wait on the save to continue.
           if (this._state && this._key) {
-            void this._state.save(this._key, { path });
+            void this._state.save(this._key, { path: newValue });
           }
 
           this._pathChanged.emit({
             name: 'path',
             oldValue,
-            newValue: path
+            newValue
           });
         }
         this.onRunningChanged(services.sessions, services.sessions.running());
@@ -287,7 +297,11 @@
       .catch(error => {
         this._pendingPath = null;
         this._pending = null;
-        if (error.response && error.response.status === 404 && path !== '/') {
+        if (
+          error.response &&
+          error.response.status === 404 &&
+          newValue !== '/'
+        ) {
           error.message = this._trans.__(
             'Directory not found: "%1"',
             this._model.path
@@ -421,7 +435,7 @@
     await this.refresh();
     await this._uploadCheckDisposed();
     if (
-      this._items.find(i => i.name === file.name) &&
+      find(this._items, i => i.name === file.name) &&
       !(await shouldOverwrite(file.name))
     ) {
       throw err;
@@ -574,7 +588,6 @@
       writable: contents.writable,
       created: contents.created,
       last_modified: contents.last_modified,
-      size: contents.size,
       mimetype: contents.mimetype,
       format: contents.format
     };
@@ -590,7 +603,7 @@
    */
   protected onRunningChanged(
     sender: Session.IManager,
-    models: Iterable<Session.IModel>
+    models: IterableOrArrayLike<Session.IModel>
   ): void {
     this._populateSessions(models);
     this._refreshed.emit(void 0);
@@ -625,13 +638,13 @@
   /**
    * Populate the model's sessions collection.
    */
-  private _populateSessions(models: Iterable<Session.IModel>): void {
+  private _populateSessions(models: IterableOrArrayLike<Session.IModel>): void {
     this._sessions.length = 0;
-    for (const model of models) {
+    each(models, model => {
       if (this._paths.has(model.path)) {
         this._sessions.push(model);
       }
-    }
+    });
   }
 
   protected translator: ITranslator;
@@ -691,11 +704,6 @@
     refreshInterval?: number;
 
     /**
-     * When the model stops polling the API. Defaults to `when-hidden`.
-     */
-    refreshStandby?: Poll.Standby | (() => boolean | Poll.Standby);
-
-    /**
      * An optional state database. If provided, the model will restore which
      * folder was last opened when it is restored.
      */
@@ -722,7 +730,7 @@
    *
    * @returns A new iterator over the model's items.
    */
-  items(): IterableIterator<Contents.IModel> {
+  items(): IIterator<Contents.IModel> {
     return this._includeHiddenFiles
       ? super.items()
       : filter(super.items(), value => !value.name.startsWith('.'));
@@ -760,11 +768,7 @@
 export class FilterFileBrowserModel extends TogglableHiddenFileBrowserModel {
   constructor(options: FilterFileBrowserModel.IOptions) {
     super(options);
-    this._filter =
-      options.filter ??
-      (model => {
-        return {};
-      });
+    this._filter = options.filter ? options.filter : model => Object.freeze({});
     this._filterDirectories = options.filterDirectories ?? true;
   }
 
@@ -783,24 +787,28 @@
    *
    * @returns A new iterator over the model's items.
    */
-  items(): IterableIterator<Contents.IModel> {
-    return filter(super.items(), value => {
+  items(): IIterator<Contents.IModel> {
+    return filter(super.items(), (value, index) => {
       if (!this._filterDirectories && value.type === 'directory') {
         return true;
       } else {
         const filtered = this._filter(value);
-        value.indices = filtered?.indices;
+        if (typeof filtered !== 'boolean') {
+          value.indices = filtered?.indices;
+        }
         return !!filtered;
       }
     });
   }
 
-  setFilter(filter: (value: Contents.IModel) => Partial<IScore> | null): void {
+  setFilter(
+    filter: (value: Contents.IModel) => boolean | Partial<IScore> | null
+  ): void {
     this._filter = filter;
     void this.refresh();
   }
 
-  private _filter: (value: Contents.IModel) => Partial<IScore> | null;
+  private _filter: (value: Contents.IModel) => boolean | Partial<IScore> | null;
   private _filterDirectories: boolean;
 }
 
@@ -815,7 +823,7 @@
     /**
      * Filter function on file browser item model
      */
-    filter?: (value: Contents.IModel) => Partial<IScore> | null;
+    filter?: (value: Contents.IModel) => boolean | Partial<IScore> | null;
 
     /**
      * Filter directories