--- packages\cells\src\celldragutils.ts (old)
+++ packages\cells\src\celldragutils.ts (new)
@@ -9,6 +9,7 @@
  * Notebook widgets.
  */
 
+import { each, IterableOrArrayLike } from '@lumino/algorithm';
 import { ICodeCellModel } from './model';
 import { Cell } from './widget';
 import { h, VirtualDOM } from '@lumino/virtualdom';
@@ -65,19 +66,18 @@
    */
   export function findCell(
     node: HTMLElement,
-    cells: Iterable<Cell>,
+    cells: IterableOrArrayLike<Cell>,
     isCellNode: (node: HTMLElement) => boolean
   ): number {
-    let cellIndex = -1;
+    let cellIndex: number = -1;
     while (node && node.parentElement) {
       if (isCellNode(node)) {
-        let index = -1;
-        for (const cell of cells) {
+        each(cells, (cell, index) => {
           if (cell.node === node) {
-            cellIndex = ++index;
-            break;
+            cellIndex = index;
+            return false;
           }
-        }
+        });
         break;
       }
       node = node.parentElement;
@@ -97,9 +97,9 @@
   ): ICellTargetArea {
     let targetArea: ICellTargetArea;
     if (cell) {
-      if (cell.editorWidget?.node.contains(target)) {
+      if (cell.editorWidget.node.contains(target)) {
         targetArea = 'input';
-      } else if (cell.promptNode?.contains(target)) {
+      } else if (cell.promptNode.contains(target)) {
         targetArea = 'prompt';
       } else {
         targetArea = 'cell';
@@ -153,10 +153,7 @@
       promptNumber = '';
     }
 
-    const cellContent = activeCell.model.sharedModel
-      .getSource()
-      .split('\n')[0]
-      .slice(0, 26);
+    const cellContent = activeCell.model.value.text.split('\n')[0].slice(0, 26);
     if (count > 1) {
       if (promptNumber !== '') {
         return VirtualDOM.realize(