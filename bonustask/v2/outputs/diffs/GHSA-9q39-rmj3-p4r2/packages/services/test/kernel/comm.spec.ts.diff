--- packages\services\test\kernel\comm.spec.ts (old)
+++ packages\services\test\kernel\comm.spec.ts (new)
@@ -1,7 +1,11 @@
 // Copyright (c) Jupyter Development Team.
 // Distributed under the terms of the Modified BSD License.
 
-import { isFulfilled, JupyterServer } from '@jupyterlab/testing';
+import {
+  isFulfilled,
+  flakyIt as it,
+  JupyterServer
+} from '@jupyterlab/testutils';
 import { PromiseDelegate } from '@lumino/coreutils';
 import { Kernel, KernelManager, KernelMessage } from '../../src';
 
@@ -38,19 +42,25 @@
 get_ipython().kernel.comm_manager.register_target("test", target_func)
 `;
 
+const server = new JupyterServer();
+
+beforeAll(async () => {
+  await server.start();
+});
+
+afterAll(async () => {
+  await server.shutdown();
+});
+
 describe('jupyter.services - Comm', () => {
-  let server: JupyterServer;
   let kernelManager: KernelManager;
   let kernel: Kernel.IKernelConnection;
 
-  jest.retryTimes(3);
-
   beforeAll(async () => {
-    server = new JupyterServer();
-    await server.start();
+    jest.setTimeout(20000);
     kernelManager = new KernelManager();
     kernel = await kernelManager.startNew({ name: 'ipython' });
-  }, 30000);
+  });
 
   afterEach(() => {
     // A no-op comm target.
@@ -61,7 +71,6 @@
 
   afterAll(async () => {
     await kernel.shutdown();
-    await server.shutdown();
   });
 
   describe('Kernel', () => {
@@ -79,7 +88,7 @@
       });
 
       it('should throw an error if there is an existing comm', () => {
-        expect(() => kernel.createComm('test', '1234')).toThrow();
+        expect(() => kernel.createComm('test', '1234')).toThrowError();
       });
 
       it('should throw an error when the kernel does not handle comms', async () => {
@@ -88,7 +97,7 @@
           { handleComms: false }
         );
         expect(kernel2.handleComms).toBe(false);
-        expect(() => kernel2.createComm('test', '1234')).toThrow();
+        expect(() => kernel2.createComm('test', '1234')).toThrowError();
       });
     });
 
@@ -265,7 +274,7 @@
           comm.send('quit');
         });
         await kernel.requestExecute({ code: SEND }, true).done;
-        await expect(promise.promise).resolves.not.toThrow();
+        await promise.promise;
       });
     });
 
@@ -313,7 +322,7 @@
           data,
           data.buffer
         ]);
-        await expect(future2.done).resolves.not.toThrow();
+        await future2.done;
       });
     });
 
@@ -321,13 +330,13 @@
       it('should send a message to the server', async () => {
         await comm.open().done;
         const future = comm.send({ foo: 'bar' }, { fizz: 'buzz' });
-        await expect(future.done).resolves.not.toThrow();
+        await future.done;
       });
 
       it('should pass through a buffers field', async () => {
         await comm.open().done;
         const future = comm.send({ buffers: 'bar' });
-        await expect(future.done).resolves.not.toThrow();
+        await future.done;
       });
     });
 
@@ -337,7 +346,7 @@
         const encoder = new TextEncoder();
         const data = encoder.encode('hello');
         const future = comm.close({ foo: 'bar' }, {}, [data, data.buffer]);
-        await expect(future.done).resolves.not.toThrow();
+        await future.done;
       });
 
       it('should trigger an onClose', async () => {
@@ -357,7 +366,7 @@
         await comm.close({ foo: 'bar' }).done;
         expect(() => {
           comm.send('test');
-        }).toThrow();
+        }).toThrowError();
       });
     });
   });