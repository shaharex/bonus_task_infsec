--- packages\services\src\contents\index.ts (old)
+++ packages\services\src\contents\index.ts (new)
@@ -1,11 +1,13 @@
 // Copyright (c) Jupyter Development Team.
 // Distributed under the terms of the Modified BSD License.
 
-import type { ISharedDocument } from '@jupyter/ydoc';
-
 import { PathExt, URLExt } from '@jupyterlab/coreutils';
 
+import { ModelDB } from '@jupyterlab/observables';
+
 import { PartialJSONObject } from '@lumino/coreutils';
+
+import { each } from '@lumino/algorithm';
 
 import { IDisposable } from '@lumino/disposable';
 
@@ -112,17 +114,6 @@
      * The indices of the matched characters in the name.
      */
     indices?: ReadonlyArray<number> | null;
-
-    /**
-     * The hexdigest hash string of content, if requested (otherwise null).
-     * It cannot be null if hash_algorithm is defined.
-     */
-    readonly hash?: string;
-
-    /**
-     * The algorithm used to compute hash value. It cannot be null if hash is defined.
-     */
-    readonly hash_algorithm?: string;
   }
 
   /**
@@ -164,13 +155,6 @@
      * The default is `true`.
      */
     content?: boolean;
-
-    /**
-     * Whether to include a hash in the response.
-     *
-     * The default is `false`.
-     */
-    hash?: boolean;
   }
 
   /**
@@ -239,49 +223,6 @@
   }
 
   /**
-   * A factory interface for creating `ISharedDocument` objects.
-   */
-  export interface ISharedFactory {
-    /**
-     * Whether the IDrive supports real-time collaboration or not.
-     * Note: If it is not provided, it is false by default.
-     */
-    readonly collaborative?: boolean;
-
-    /**
-     * Create a new `ISharedDocument` instance.
-     *
-     * It should return `undefined` if the factory is not able to create a `ISharedDocument`.
-     */
-    createNew(options: ISharedFactoryOptions): ISharedDocument | undefined;
-  }
-
-  /**
-   * The options used to instantiate a ISharedDocument
-   */
-  export interface ISharedFactoryOptions {
-    /**
-     * The path of the file.
-     */
-    path: string;
-    /**
-     * The format of the document. If null, the document won't be
-     * collaborative.
-     */
-    format: FileFormat;
-    /**
-     * The content type of the document.
-     */
-    contentType: ContentType;
-    /**
-     * Wether the document is collaborative or not.
-     *
-     * The default value is `true`.
-     */
-    collaborative?: boolean;
-  }
-
-  /**
    * The interface for a contents manager.
    */
   export interface IManager extends IDisposable {
@@ -304,7 +245,7 @@
      * Given a path of the form `drive:local/portion/of/it.txt`
      * get the local part of it.
      *
-     * @param path the path.
+     * @param path: the path.
      *
      * @returns The local part of the path.
      */
@@ -315,7 +256,7 @@
      * leading slashes from the local part of the path, while retaining
      * the drive name if it exists.
      *
-     * @param path the path.
+     * @param path: the path.
      *
      * @returns The normalized path.
      */
@@ -328,7 +269,7 @@
      *  - if root has a drive name, the result is prefixed with "<drive>:"
      *  - before adding drive name, leading slashes are removed
      *
-     * @param path the path.
+     * @param path: the path.
      *
      * @returns The normalized path.
      */
@@ -339,25 +280,25 @@
      * get the name of the drive. If the path is missing
      * a drive portion, returns an empty string.
      *
-     * @param path the path.
+     * @param path: the path.
      *
      * @returns The drive name for the path, or the empty string.
      */
     driveName(path: string): string;
 
     /**
-     * Given a path, get a shared model IFactory from the
+     * Given a path, get a ModelDB.IFactory from the
      * relevant backend. Returns `null` if the backend
      * does not provide one.
      */
-    getSharedModelFactory(path: string): ISharedFactory | null;
+    getModelDBFactory(path: string): ModelDB.IFactory | null;
 
     /**
      * Get a file or directory.
      *
-     * @param path The path to the file.
-     *
-     * @param options The options used to fetch the file.
+     * @param path: The path to the file.
+     *
+     * @param options: The options used to fetch the file.
      *
      * @returns A promise which resolves with the file content.
      */
@@ -377,7 +318,7 @@
     /**
      * Create a new untitled file or directory in the specified directory path.
      *
-     * @param options The options used to create the file.
+     * @param options: The options used to create the file.
      *
      * @returns A promise which resolves with the created file content when the
      *    file is created.
@@ -489,10 +430,10 @@
     readonly serverSettings: ServerConnection.ISettings;
 
     /**
-     * An optional shared model factory instance for the
+     * An optional ModelDB.IFactory instance for the
      * drive.
      */
-    readonly sharedModelFactory?: ISharedFactory;
+    readonly modelDBFactory?: ModelDB.IFactory;
 
     /**
      * A signal emitted when a file operation takes place.
@@ -502,9 +443,9 @@
     /**
      * Get a file or directory.
      *
-     * @param localPath The path to the file.
-     *
-     * @param options The options used to fetch the file.
+     * @param localPath: The path to the file.
+     *
+     * @param options: The options used to fetch the file.
      *
      * @returns A promise which resolves with the file content.
      */
@@ -513,7 +454,7 @@
     /**
      * Get an encoded download url given a file path.
      *
-     * @returns A promise which resolves with the absolute POSIX
+     * @param A promise which resolves with the absolute POSIX
      *   file path on the server.
      *
      * #### Notes
@@ -524,7 +465,7 @@
     /**
      * Create a new untitled file or directory in the specified directory path.
      *
-     * @param options The options used to create the file.
+     * @param options: The options used to create the file.
      *
      * @returns A promise which resolves with the created file content when the
      *    file is created.
@@ -680,20 +621,20 @@
   }
 
   /**
-   * Given a path, get a shared model factory from the
-   * relevant backend. Returns `null` if the backend
+   * Given a path, get a ModelDB.IFactory from the
+   * relevant backend. Returns `undefined` if the backend
    * does not provide one.
    */
-  getSharedModelFactory(path: string): Contents.ISharedFactory | null {
+  getModelDBFactory(path: string): ModelDB.IFactory | null {
     const [drive] = this._driveForPath(path);
-    return drive?.sharedModelFactory ?? null;
+    return drive?.modelDBFactory ?? null;
   }
 
   /**
    * Given a path of the form `drive:local/portion/of/it.txt`
    * get the local part of it.
    *
-   * @param path the path.
+   * @param path: the path.
    *
    * @returns The local part of the path.
    */
@@ -711,7 +652,7 @@
    * leading slashes from the local part of the path, while retaining
    * the drive name if it exists.
    *
-   * @param path the path.
+   * @param path: the path.
    *
    * @returns The normalized path.
    */
@@ -730,7 +671,7 @@
    *  - if root has a drive name, the result is prefixed with "<drive>:"
    *  - before adding drive name, leading slashes are removed
    *
-   * @param path the path.
+   * @param path: the path.
    *
    * @returns The normalized path.
    */
@@ -746,7 +687,7 @@
    * get the name of the drive. If the path is missing
    * a drive portion, returns an empty string.
    *
-   * @param path the path.
+   * @param path: the path.
    *
    * @returns The drive name for the path, or the empty string.
    */
@@ -765,9 +706,9 @@
   /**
    * Get a file or directory.
    *
-   * @param path The path to the file.
-   *
-   * @param options The options used to fetch the file.
+   * @param path: The path to the file.
+   *
+   * @param options: The options used to fetch the file.
    *
    * @returns A promise which resolves with the file content.
    */
@@ -779,9 +720,12 @@
     return drive.get(localPath, options).then(contentsModel => {
       const listing: Contents.IModel[] = [];
       if (contentsModel.type === 'directory' && contentsModel.content) {
-        for (const item of contentsModel.content) {
-          listing.push({ ...item, path: this._toGlobalPath(drive, item.path) });
-        }
+        each(contentsModel.content, (item: Contents.IModel) => {
+          listing.push({
+            ...item,
+            path: this._toGlobalPath(drive, item.path)
+          } as Contents.IModel);
+        });
         return {
           ...contentsModel,
           path: this._toGlobalPath(drive, localPath),
@@ -816,7 +760,7 @@
   /**
    * Create a new untitled file or directory in the specified directory path.
    *
-   * @param options The options used to create the file.
+   * @param options: The options used to create the file.
    *
    * @returns A promise which resolves with the created file content when the
    *    file is created.
@@ -993,9 +937,9 @@
    * Given a drive and a local path, construct a fully qualified
    * path. The inverse of `_driveForPath`.
    *
-   * @param drive an `IDrive`.
-   *
-   * @param localPath the local path on the drive.
+   * @param drive: an `IDrive`.
+   *
+   * @param localPath: the local path on the drive.
    *
    * @returns the fully qualified path.
    */
@@ -1013,7 +957,7 @@
    * `'driveName:path/to/file'`. If there is no `driveName`
    * prepended to the path, it returns the default drive.
    *
-   * @param path a path to a file.
+   * @param path: a path to a file.
    *
    * @returns A tuple containing an `IDrive` object for the path,
    * and a local path for that drive.
@@ -1121,13 +1065,13 @@
   /**
    * Get a file or directory.
    *
-   * @param localPath The path to the file.
-   *
-   * @param options The options used to fetch the file.
+   * @param localPath: The path to the file.
+   *
+   * @param options: The options used to fetch the file.
    *
    * @returns A promise which resolves with the file content.
    *
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents) and validates the response model.
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents) and validates the response model.
    */
   async get(
     localPath: string,
@@ -1140,8 +1084,7 @@
         delete options['format'];
       }
       const content = options.content ? '1' : '0';
-      const hash = options.hash ? '1' : '0';
-      const params: PartialJSONObject = { ...options, content, hash };
+      const params: PartialJSONObject = { ...options, content };
       url += URLExt.objectToQueryString(params);
     }
 
@@ -1169,13 +1112,7 @@
   getDownloadUrl(localPath: string): Promise<string> {
     const baseUrl = this.serverSettings.baseUrl;
     let url = URLExt.join(baseUrl, FILES_URL, URLExt.encodeParts(localPath));
-    let cookie = '';
-    try {
-      cookie = document.cookie;
-    } catch (e) {
-      // e.g. SecurityError in case of CSP Sandbox
-    }
-    const xsrfTokenMatch = cookie.match('\\b_xsrf=([^;]*)\\b');
+    const xsrfTokenMatch = document.cookie.match('\\b_xsrf=([^;]*)\\b');
     if (xsrfTokenMatch) {
       const fullUrl = new URL(url);
       fullUrl.searchParams.append('_xsrf', xsrfTokenMatch[1]);
@@ -1187,13 +1124,13 @@
   /**
    * Create a new untitled file or directory in the specified directory path.
    *
-   * @param options The options used to create the file.
+   * @param options: The options used to create the file.
    *
    * @returns A promise which resolves with the created file content when the
    *    file is created.
    *
    * #### Notes
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents) and validates the response model.
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents) and validates the response model.
    */
   async newUntitled(
     options: Contents.ICreateOptions = {}
@@ -1235,7 +1172,7 @@
    * @returns A promise which resolves when the file is deleted.
    *
    * #### Notes
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents).
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents).
    */
   async delete(localPath: string): Promise<void> {
     const url = this._getUrl(localPath);
@@ -1266,7 +1203,7 @@
    *   the file is renamed.
    *
    * #### Notes
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents) and validates the response model.
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents) and validates the response model.
    */
   async rename(
     oldLocalPath: string,
@@ -1306,7 +1243,7 @@
    * #### Notes
    * Ensure that `model.content` is populated for the file.
    *
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents) and validates the response model.
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents) and validates the response model.
    */
   async save(
     localPath: string,
@@ -1347,7 +1284,7 @@
    * #### Notes
    * The server will select the name of the copied file.
    *
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents) and validates the response model.
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents) and validates the response model.
    */
   async copy(fromFile: string, toDir: string): Promise<Contents.IModel> {
     const settings = this.serverSettings;
@@ -1380,7 +1317,7 @@
    *   checkpoint is created.
    *
    * #### Notes
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents) and validates the response model.
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents) and validates the response model.
    */
   async createCheckpoint(
     localPath: string
@@ -1410,7 +1347,7 @@
    *    the file.
    *
    * #### Notes
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents) and validates the response model.
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents) and validates the response model.
    */
   async listCheckpoints(
     localPath: string
@@ -1445,7 +1382,7 @@
    * @returns A promise which resolves when the checkpoint is restored.
    *
    * #### Notes
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents).
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents).
    */
   async restoreCheckpoint(
     localPath: string,
@@ -1474,7 +1411,7 @@
    * @returns A promise which resolves when the checkpoint is deleted.
    *
    * #### Notes
-   * Uses the [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents).
+   * Uses the [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents).
    */
   async deleteCheckpoint(
     localPath: string,
@@ -1549,7 +1486,7 @@
     /**
      * A REST endpoint for drive requests.
      * If not given, defaults to the Jupyter
-     * REST API given by [Jupyter Server API](https://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter-server/jupyter_server/main/jupyter_server/services/api/api.yaml#!/contents).
+     * REST API given by [Jupyter Notebook API](http://petstore.swagger.io/?url=https://raw.githubusercontent.com/jupyter/notebook/master/notebook/services/api/api.yaml#!/contents).
      */
     apiEndpoint?: string;
   }