--- packages\shortcuts-extension\src\index.ts (old)
+++ packages\shortcuts-extension\src\index.ts (new)
@@ -11,39 +11,37 @@
 } from '@jupyterlab/application';
 import { ISettingRegistry, SettingRegistry } from '@jupyterlab/settingregistry';
 import { ITranslator, nullTranslator } from '@jupyterlab/translation';
-import {
-  IFormRenderer,
-  IFormRendererRegistry
-} from '@jupyterlab/ui-components';
+import { IFormComponentRegistry } from '@jupyterlab/ui-components';
 import { CommandRegistry } from '@lumino/commands';
 import {
   JSONExt,
-  PartialJSONValue,
   ReadonlyPartialJSONObject,
   ReadonlyPartialJSONValue
 } from '@lumino/coreutils';
 import { DisposableSet, IDisposable } from '@lumino/disposable';
 import { Platform } from '@lumino/domutils';
-import { CommandIDs, IShortcutsSettingsLayout, IShortcutUI } from './types';
+import { Menu } from '@lumino/widgets';
+import { IShortcutUIexternal } from './components';
 import { renderShortCut } from './renderer';
-import { ISignal, Signal } from '@lumino/signaling';
-
-const SHORTCUT_PLUGIN_ID = '@jupyterlab/shortcuts-extension:shortcuts';
 
 function getExternalForJupyterLab(
   settingRegistry: ISettingRegistry,
   app: JupyterFrontEnd,
-  translator: ITranslator,
-  actionRequested: ISignal<unknown, IShortcutUI.ActionRequest>
-): IShortcutUI.IExternalBundle {
+  translator: ITranslator
+): IShortcutUIexternal {
+  const { commands } = app;
+  const shortcutPluginLocation = '@jupyterlab/shortcuts-extension:shortcuts';
   return {
     translator,
-    getSettings: () =>
-      settingRegistry.load(SHORTCUT_PLUGIN_ID, true) as Promise<
-        ISettingRegistry.ISettings<IShortcutsSettingsLayout>
-      >,
-    commandRegistry: app.commands,
-    actionRequested
+    getAllShortCutSettings: () =>
+      settingRegistry.reload(shortcutPluginLocation),
+    removeShortCut: (key: string) =>
+      settingRegistry.remove(shortcutPluginLocation, key),
+    createMenu: () => new Menu({ commands }),
+    hasCommand: (id: string) => commands.hasCommand(id),
+    addCommand: (id: string, options: CommandRegistry.ICommandOptions) =>
+      commands.addCommand(id, options),
+    getLabel: (id: string) => commands.label(id)
   };
 }
 
@@ -77,118 +75,28 @@
  * required, using the `'body'` selector is more appropriate.
  */
 const shortcuts: JupyterFrontEndPlugin<void> = {
-  id: SHORTCUT_PLUGIN_ID,
-  description: 'Adds the keyboard shortcuts editor.',
+  id: '@jupyterlab/shortcuts-extension:shortcuts',
   requires: [ISettingRegistry],
-  optional: [ITranslator, IFormRendererRegistry],
+  optional: [ITranslator, IFormComponentRegistry],
   activate: async (
     app: JupyterFrontEnd,
     registry: ISettingRegistry,
     translator: ITranslator | null,
-    editorRegistry: IFormRendererRegistry | null
+    editorRegistry: IFormComponentRegistry | null
   ) => {
     const translator_ = translator ?? nullTranslator;
     const trans = translator_.load('jupyterlab');
     const { commands } = app;
     let canonical: ISettingRegistry.ISchema | null;
-    // Stores initial value of the shortcuts `default` value,
-    // which reflects the `overrides.json` contents.
-    let cannonicalOverrides: PartialJSONValue | undefined;
     let loaded: { [name: string]: ISettingRegistry.IShortcut[] } = {};
 
     if (editorRegistry) {
-      const actionRequested = new Signal<unknown, IShortcutUI.ActionRequest>(
-        {}
-      );
-      const isKeybindingNode = (node: HTMLElement) =>
-        node.dataset['shortcut'] !== undefined;
-
-      app.commands.addCommand(CommandIDs.editBinding, {
-        label: trans.__('Edit Keybinding'),
-        caption: trans.__('Edit existing keybinding'),
-        execute: () => {
-          const node = app.contextMenuHitTest(isKeybindingNode);
-          const keybinding = node?.dataset['keybinding'];
-          const shortcutId = node?.dataset['shortcut'];
-          if (!shortcutId || !keybinding) {
-            return console.log('Missing shortcut id/keybinding information');
-          }
-          actionRequested.emit({
-            request: 'edit-keybinding',
-            keybinding: parseInt(keybinding, 10),
-            shortcutId
-          });
-        }
+      editorRegistry.addRenderer('shortcuts', (props: any) => {
+        return renderShortCut({
+          external: getExternalForJupyterLab(registry, app, translator_),
+          ...props
+        });
       });
-
-      app.commands.addCommand(CommandIDs.deleteBinding, {
-        label: trans.__('Delete Keybinding'),
-        caption: trans.__('Delete chosen keybinding'),
-        execute: () => {
-          const node = app.contextMenuHitTest(isKeybindingNode);
-          const keybinding = node?.dataset['keybinding'];
-          const shortcutId = node?.dataset['shortcut'];
-          if (!shortcutId || !keybinding) {
-            return console.log('Missing shortcut id/keybinding information');
-          }
-          actionRequested.emit({
-            request: 'delete-keybinding',
-            keybinding: parseInt(keybinding, 10),
-            shortcutId
-          });
-        }
-      });
-
-      app.commands.addCommand(CommandIDs.addBinding, {
-        label: trans.__('Add Keybinding'),
-        caption: trans.__('Add new keybinding for existing shortcut target'),
-        execute: () => {
-          const node = app.contextMenuHitTest(isKeybindingNode);
-          const shortcutId = node?.dataset['shortcut'];
-          if (!shortcutId) {
-            return console.log('Missing shortcut id to add keybinding to');
-          }
-          actionRequested.emit({
-            request: 'add-keybinding',
-            shortcutId
-          });
-        }
-      });
-
-      commands.addCommand(CommandIDs.toggleSelectors, {
-        label: trans.__('Toggle Selectors'),
-        caption: trans.__('Toggle command selectors'),
-        execute: () => {
-          actionRequested.emit({
-            request: 'toggle-selectors'
-          });
-        }
-      });
-
-      commands.addCommand(CommandIDs.resetAll, {
-        label: trans.__('Reset All'),
-        caption: trans.__('Reset all shortcuts'),
-        execute: () => {
-          actionRequested.emit({
-            request: 'reset-all'
-          });
-        }
-      });
-
-      const component: IFormRenderer = {
-        fieldRenderer: (props: any) => {
-          return renderShortCut({
-            external: getExternalForJupyterLab(
-              registry,
-              app,
-              translator_,
-              actionRequested
-            ),
-            ...props
-          });
-        }
-      };
-      editorRegistry.addRenderer(`${shortcuts.id}.shortcuts`, component);
     }
 
     /**
@@ -196,11 +104,7 @@
      */
     function populate(schema: ISettingRegistry.ISchema) {
       const commands = app.commands.listCommands().join('\n');
-      if (!cannonicalOverrides) {
-        cannonicalOverrides = JSONExt.deepCopy(
-          schema.properties!.shortcuts.default!
-        );
-      }
+
       loaded = {};
       schema.properties!.shortcuts.default = Object.keys(registry.plugins)
         .map(plugin => {
@@ -209,7 +113,7 @@
           loaded[plugin] = shortcuts;
           return shortcuts;
         })
-        .concat([cannonicalOverrides as any[]])
+        .concat([schema.properties!.shortcuts.default as any[]])
         .reduce((acc, val) => {
           if (Platform.IS_MAC) {
             return acc.concat(val);
@@ -250,7 +154,7 @@
       );
     }
 
-    registry.pluginChanged.connect(async (_, plugin) => {
+    registry.pluginChanged.connect(async (sender, plugin) => {
       if (plugin !== shortcuts.id) {
         // If the plugin changed its shortcuts, reload everything.
         const oldShortcuts = loaded[plugin];
@@ -260,13 +164,8 @@
           oldShortcuts === undefined ||
           !JSONExt.deepEqual(oldShortcuts, newShortcuts)
         ) {
-          // Empty the default values to avoid shortcut collisions.
           canonical = null;
-          const schema = registry.plugins[shortcuts.id]!.schema;
-          schema.properties!.shortcuts.default = cannonicalOverrides;
-
-          // Reload the settings.
-          await registry.load(shortcuts.id, true);
+          await registry.reload(shortcuts.id);
         }
       }
     });