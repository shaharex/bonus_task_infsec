--- packages\application\src\lab.ts (old)
+++ packages\application\src\lab.ts (new)
@@ -1,11 +1,11 @@
 // Copyright (c) Jupyter Development Team.
 // Distributed under the terms of the Modified BSD License.
 
+import { Notification, NotificationManager } from '@jupyterlab/apputils';
 import { PageConfig } from '@jupyterlab/coreutils';
 import { Base64ModelFactory } from '@jupyterlab/docregistry';
 import { IRenderMime } from '@jupyterlab/rendermime-interfaces';
-import { ServiceManager } from '@jupyterlab/services';
-import { PromiseDelegate, Token } from '@lumino/coreutils';
+import { Token } from '@lumino/coreutils';
 import { JupyterFrontEnd, JupyterFrontEndPlugin } from './frontend';
 import { createRendermimePlugins } from './mimerenderers';
 import { ILabShell, LabShell } from './shell';
@@ -19,17 +19,10 @@
    * Construct a new JupyterLab object.
    */
   constructor(options: JupyterLab.IOptions = { shell: new LabShell() }) {
-    super({
-      ...options,
-      shell: options.shell || new LabShell(),
-      serviceManager:
-        options.serviceManager ||
-        new ServiceManager({
-          standby: () => {
-            return !this._info.isConnected || 'when-hidden';
-          }
-        })
-    });
+    super({ ...options, shell: options.shell || new LabShell() });
+    this.restored = this.shell.restored
+      .then(() => undefined)
+      .catch(() => undefined);
 
     // Create an IInfo dictionary from the options to override the defaults.
     const info = Object.keys(JupyterLab.defaultInfo).reduce((acc, val) => {
@@ -41,34 +34,6 @@
 
     // Populate application info.
     this._info = { ...JupyterLab.defaultInfo, ...info };
-
-    this.restored = this.shell.restored
-      .then(async () => {
-        const activated: Promise<void | void[]>[] = [];
-        const deferred = this.activateDeferredPlugins().catch(error => {
-          console.error('Error when activating deferred plugins\n:', error);
-        });
-        activated.push(deferred);
-        if (this._info.deferred) {
-          const customizedDeferred = Promise.all(
-            this._info.deferred.matches.map(pluginID =>
-              this.activatePlugin(pluginID)
-            )
-          ).catch(error => {
-            console.error(
-              'Error when activating customized list of deferred plugins:\n',
-              error
-            );
-          });
-          activated.push(customizedDeferred);
-        }
-        Promise.all(activated)
-          .then(() => {
-            this._allPluginsActivated.resolve();
-          })
-          .catch(() => undefined);
-      })
-      .catch(() => undefined);
 
     // Populate application paths override the defaults if necessary.
     const defaultURLs = JupyterLab.defaultPaths.urls;
@@ -153,18 +118,25 @@
   }
 
   /**
+   * Get a handle on the notification manager.
+   *
+   * ### Notes
+   * You should use stable API `Notification.manager` from `@jupyterlab/apputils`.
+   *
+   * @deprecated This is an experimental feature used for integration testing.
+   * @private
+   */
+  get notificationManager(): NotificationManager {
+    return Notification.manager;
+  }
+
+  /**
    * The JupyterLab application paths dictionary.
    */
   get paths(): JupyterFrontEnd.IPaths {
     return this._paths;
   }
 
-  /**
-   * Promise that resolves when all the plugins are activated, including the deferred.
-   */
-  get allPluginsActivated(): Promise<void> {
-    return this._allPluginsActivated.promise;
-  }
   /**
    * Register plugins from a plugin module.
    *
@@ -199,106 +171,8 @@
     });
   }
 
-  /**
-   * Override keydown handling to prevent command shortcuts from preventing user input.
-   *
-   * This introduces a slight delay to the command invocation, but no delay to user input.
-   */
-  protected evtKeydown(keyDownEvent: KeyboardEvent): void {
-    const permissionToExecute = new PromiseDelegate<boolean>();
-
-    // Hold the execution of any keybinding until we know if this event would cause text insertion
-    this.commands.holdKeyBindingExecution(
-      keyDownEvent,
-      permissionToExecute.promise
-    );
-
-    // Process the key immediately to invoke the prevent default handlers as needed
-    this.commands.processKeydownEvent(keyDownEvent);
-
-    // If we do not know the target, we cannot check if input would be inserted
-    // as there is no target to attach the `beforeinput` event listener; in that
-    // case we just permit execution immediately (this may happen for programmatic
-    // uses of keydown)
-    const target = keyDownEvent.target;
-    if (!target) {
-      return permissionToExecute.resolve(true);
-    }
-
-    let onBeforeInput: ((event: InputEvent) => void) | null = null;
-    let onBeforeKeyUp: ((event: KeyboardEvent) => void) | null = null;
-
-    const disconnectListeners = () => {
-      if (onBeforeInput) {
-        target.removeEventListener('beforeinput', onBeforeInput);
-      }
-      if (onBeforeKeyUp) {
-        target.removeEventListener('keyup', onBeforeKeyUp);
-      }
-    };
-
-    // Permit the execution conditionally, depending on whether the event would lead to text insertion
-    const causesInputPromise = Promise.race([
-      new Promise(resolve => {
-        onBeforeInput = (inputEvent: InputEvent) => {
-          switch (inputEvent.inputType) {
-            case 'historyUndo':
-            case 'historyRedo': {
-              if (
-                inputEvent.target instanceof Element &&
-                inputEvent.target.closest('[data-jp-undoer]')
-              ) {
-                // Allow to use custom undo/redo bindings on `jpUndoer`s
-                inputEvent.preventDefault();
-                disconnectListeners();
-                return resolve(false);
-              }
-              break;
-            }
-            case 'insertLineBreak': {
-              if (
-                inputEvent.target instanceof Element &&
-                inputEvent.target.closest('.jp-Cell')
-              ) {
-                // Allow to override the default action of Shift + Enter on cells as this is used for cell execution
-                inputEvent.preventDefault();
-                disconnectListeners();
-                return resolve(false);
-              }
-              break;
-            }
-          }
-          disconnectListeners();
-          return resolve(true);
-        };
-        target.addEventListener('beforeinput', onBeforeInput, { once: true });
-      }),
-      new Promise(resolve => {
-        onBeforeKeyUp = (keyUpEvent: KeyboardEvent) => {
-          if (keyUpEvent.code === keyDownEvent.code) {
-            disconnectListeners();
-            return resolve(false);
-          }
-        };
-        target.addEventListener('keyup', onBeforeKeyUp, { once: true });
-      }),
-      new Promise(resolve => {
-        setTimeout(() => {
-          disconnectListeners();
-          return resolve(false);
-        }, Private.INPUT_GUARD_TIMEOUT);
-      })
-    ]);
-    causesInputPromise
-      .then(willCauseInput => {
-        permissionToExecute.resolve(!willCauseInput);
-      })
-      .catch(console.warn);
-  }
-
-  private _info: JupyterLab.IInfo = JupyterLab.defaultInfo;
+  private _info: JupyterLab.IInfo;
   private _paths: JupyterFrontEnd.IPaths;
-  private _allPluginsActivated = new PromiseDelegate<void>();
 }
 
 /**
@@ -309,7 +183,7 @@
    * The options used to initialize a JupyterLab object.
    */
   export interface IOptions
-    extends Partial<JupyterFrontEnd.IOptions<ILabShell>>,
+    extends JupyterFrontEnd.IOptions<LabShell>,
       Partial<IInfo> {
     paths?: Partial<JupyterFrontEnd.IPaths>;
   }
@@ -317,10 +191,7 @@
   /**
    * The layout restorer token.
    */
-  export const IInfo = new Token<IInfo>(
-    '@jupyterlab/application:IInfo',
-    'A service providing metadata about the current application, including disabled extensions and whether dev mode is enabled.'
-  );
+  export const IInfo = new Token<IInfo>('@jupyterlab/application:IInfo');
 
   /**
    * The information about a JupyterLab application.
@@ -347,72 +218,9 @@
     readonly mimeExtensions: IRenderMime.IExtensionModule[];
 
     /**
-     * The information about available plugins.
-     */
-    readonly availablePlugins: IPluginInfo[];
-
-    /**
      * Whether files are cached on the server.
      */
     readonly filesCached: boolean;
-
-    /**
-     * Every periodic network polling should be paused while this is set
-     * to `false`. Extensions should use this value to decide whether to proceed
-     * with the polling.
-     * The extensions may also set this value to `false` if there is no need to
-     * fetch anything from the server backend basing on some conditions
-     * (e.g. when an error message dialog is displayed).
-     * At the same time, the extensions are responsible for setting this value
-     * back to `true`.
-     */
-    isConnected: boolean;
-  }
-
-  /*
-   * A read-only subset of the `Token`.
-   */
-  export interface IToken
-    extends Readonly<Pick<Token<any>, 'name' | 'description'>> {
-    // no-op
-  }
-
-  /**
-   * A readonly subset of lumino plugin bundle (excluding activation function,
-   * service, and state information, and runtime token details).
-   */
-  interface ILuminoPluginData
-    extends Readonly<
-      Pick<JupyterFrontEndPlugin<void>, 'id' | 'description' | 'autoStart'>
-    > {
-    /**
-     * The types of required services for the plugin, or `[]`.
-     */
-    readonly requires: IToken[];
-
-    /**
-     * The types of optional services for the the plugin, or `[]`.
-     */
-    readonly optional: IToken[];
-
-    /**
-     * The type of service provided by the plugin, or `null`.
-     */
-    readonly provides: IToken | null;
-  }
-
-  /**
-   * A subset of plugin bundle enriched with JupyterLab extension metadata.
-   */
-  export interface IPluginInfo extends ILuminoPluginData {
-    /**
-     * The name of the extension which provides the plugin.
-     */
-    extension: string;
-    /**
-     * Whether the plugin is enabled.
-     */
-    enabled: boolean;
   }
 
   /**
@@ -423,9 +231,7 @@
     deferred: { patterns: [], matches: [] },
     disabled: { patterns: [], matches: [] },
     mimeExtensions: [],
-    availablePlugins: [],
-    filesCached: PageConfig.getOption('cacheFiles').toLowerCase() === 'true',
-    isConnected: true
+    filesCached: PageConfig.getOption('cacheFiles').toLowerCase() === 'true'
   };
 
   /**
@@ -471,18 +277,3 @@
       | JupyterFrontEndPlugin<any, any, any>[];
   }
 }
-
-/**
- * A namespace for module-private functionality.
- */
-namespace Private {
-  /**
-   * The delay for invoking a command introduced by user input guard.
-   * Decreasing this value may lead to commands incorrectly triggering
-   * on user input. Increasing this value will lead to longer delay for
-   * command invocation. Note that user input is never delayed.
-   *
-   * The value represents the number in milliseconds.
-   */
-  export const INPUT_GUARD_TIMEOUT = 10;
-}