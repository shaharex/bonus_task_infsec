--- packages\codeeditor\src\widget.ts (old)
+++ packages\codeeditor\src\widget.ts (new)
@@ -2,7 +2,7 @@
 // Distributed under the terms of the Modified BSD License.
 
 import { MimeData } from '@lumino/coreutils';
-import { Drag } from '@lumino/dragdrop';
+import { IDragEvent } from '@lumino/dragdrop';
 import { Message } from '@lumino/messaging';
 import { Widget } from '@lumino/widgets';
 import { CodeEditor } from './';
@@ -37,13 +37,15 @@
    */
   constructor(options: CodeEditorWrapper.IOptions) {
     super();
-    const { factory, model, editorOptions } = options;
-    const editor = (this.editor = factory({
+    const editor = (this.editor = options.factory({
       host: this.node,
-      model,
-      ...editorOptions
+      model: options.model,
+      uuid: options.uuid,
+      config: options.config,
+      selectionStyle: options.selectionStyle
     }));
     editor.model.selections.changed.connect(this._onSelectionsChanged, this);
+    this._updateOnShow = options.updateOnShow !== false;
   }
 
   /**
@@ -61,12 +63,12 @@
   /**
    * Dispose of the resources held by the widget.
    */
-  dispose(): void {
+  dispose() {
     if (this.isDisposed) {
       return;
     }
+    super.dispose();
     this.editor.dispose();
-    super.dispose();
   }
 
   /**
@@ -82,16 +84,16 @@
   handleEvent(event: Event): void {
     switch (event.type) {
       case 'lm-dragenter':
-        this._evtDragEnter(event as Drag.Event);
+        this._evtDragEnter(event as IDragEvent);
         break;
       case 'lm-dragleave':
-        this._evtDragLeave(event as Drag.Event);
+        this._evtDragLeave(event as IDragEvent);
         break;
       case 'lm-dragover':
-        this._evtDragOver(event as Drag.Event);
+        this._evtDragOver(event as IDragEvent);
         break;
       case 'lm-drop':
-        this._evtDrop(event as Drag.Event);
+        this._evtDrop(event as IDragEvent);
         break;
       default:
         break;
@@ -115,6 +117,12 @@
     node.addEventListener('lm-dragleave', this);
     node.addEventListener('lm-dragover', this);
     node.addEventListener('lm-drop', this);
+    // We have to refresh at least once after attaching,
+    // while visible.
+    this._hasRefreshedSinceAttach = false;
+    if (this.isVisible) {
+      this.update();
+    }
   }
 
   /**
@@ -126,6 +134,36 @@
     node.removeEventListener('lm-dragleave', this);
     node.removeEventListener('lm-dragover', this);
     node.removeEventListener('lm-drop', this);
+  }
+
+  /**
+   * A message handler invoked on an `'after-show'` message.
+   */
+  protected onAfterShow(msg: Message): void {
+    if (this._updateOnShow || !this._hasRefreshedSinceAttach) {
+      this.update();
+    }
+  }
+
+  /**
+   * A message handler invoked on a `'resize'` message.
+   */
+  protected onResize(msg: Widget.ResizeMessage): void {
+    if (msg.width >= 0 && msg.height >= 0) {
+      this.editor.setSize(msg);
+    } else if (this.isVisible) {
+      this.editor.resizeToFit();
+    }
+  }
+
+  /**
+   * A message handler invoked on an `'update-request'` message.
+   */
+  protected onUpdateRequest(msg: Message): void {
+    if (this.isVisible) {
+      this._hasRefreshedSinceAttach = true;
+      this.editor.refresh();
+    }
   }
 
   /**
@@ -158,7 +196,7 @@
   /**
    * Handle the `'lm-dragenter'` event for the widget.
    */
-  private _evtDragEnter(event: Drag.Event): void {
+  private _evtDragEnter(event: IDragEvent): void {
     if (this.editor.getOption('readOnly') === true) {
       return;
     }
@@ -174,7 +212,7 @@
   /**
    * Handle the `'lm-dragleave'` event for the widget.
    */
-  private _evtDragLeave(event: Drag.Event): void {
+  private _evtDragLeave(event: IDragEvent): void {
     this.removeClass(DROP_TARGET_CLASS);
     if (this.editor.getOption('readOnly') === true) {
       return;
@@ -190,7 +228,7 @@
   /**
    * Handle the `'lm-dragover'` event for the widget.
    */
-  private _evtDragOver(event: Drag.Event): void {
+  private _evtDragOver(event: IDragEvent): void {
     this.removeClass(DROP_TARGET_CLASS);
     if (this.editor.getOption('readOnly') === true) {
       return;
@@ -208,7 +246,7 @@
   /**
    * Handle the `'lm-drop'` event for the widget.
    */
-  private _evtDrop(event: Drag.Event): void {
+  private _evtDrop(event: IDragEvent): void {
     if (this.editor.getOption('readOnly') === true) {
       return;
     }
@@ -216,11 +254,15 @@
     if (data === undefined) {
       return;
     }
-    const coordinate: CodeEditor.ICoordinate = {
+    const coordinate = {
       top: event.y,
       bottom: event.y,
       left: event.x,
-      right: event.x
+      right: event.x,
+      x: event.x,
+      y: event.y,
+      width: 0,
+      height: 0
     };
     const position = this.editor.getPositionForCoordinate(coordinate);
     if (position === null) {
@@ -234,8 +276,11 @@
       return;
     }
     const offset = this.editor.getOffsetAt(position);
-    this.model.sharedModel.updateSource(offset, offset, data);
-  }
+    this.model.value.insert(offset, data);
+  }
+
+  private _updateOnShow: boolean;
+  private _hasRefreshedSinceAttach = false;
 }
 
 /**
@@ -250,20 +295,35 @@
      * A code editor factory.
      *
      * #### Notes
-     * The widget needs a factory and a the editor options
-     * because it needs to provide its own node as the host.
+     * The widget needs a factory and a model instead of a `CodeEditor.IEditor`
+     * object because it needs to provide its own node as the host.
      */
     factory: CodeEditor.Factory;
 
     /**
-     * The content model for the wrapper.
+     * The model used to initialize the code editor.
      */
     model: CodeEditor.IModel;
 
     /**
-     * Code editor options
-     */
-    editorOptions?: Omit<CodeEditor.IOptions, 'host' | 'model'>;
+     * The desired uuid for the editor.
+     */
+    uuid?: string;
+
+    /**
+     * The configuration options for the editor.
+     */
+    config?: Partial<CodeEditor.IConfig>;
+
+    /**
+     * The default selection style for the editor.
+     */
+    selectionStyle?: CodeEditor.ISelectionStyle;
+
+    /**
+     * Whether to send an update request to the editor when it is shown.
+     */
+    updateOnShow?: boolean;
   }
 }
 