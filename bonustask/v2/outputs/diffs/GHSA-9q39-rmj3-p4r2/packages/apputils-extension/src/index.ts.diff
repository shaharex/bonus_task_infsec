--- packages\apputils-extension\src\index.ts (old)
+++ packages\apputils-extension\src\index.ts (new)
@@ -23,13 +23,13 @@
   MainAreaWidget,
   Printing,
   Sanitizer,
-  SessionContextDialogs,
+  sessionContextDialogs,
   WindowResolver
 } from '@jupyterlab/apputils';
 import { PageConfig, PathExt, URLExt } from '@jupyterlab/coreutils';
 import { ISettingRegistry } from '@jupyterlab/settingregistry';
 import { IStateDB, StateDB } from '@jupyterlab/statedb';
-import { ITranslator, nullTranslator } from '@jupyterlab/translation';
+import { ITranslator } from '@jupyterlab/translation';
 import { jupyterFaviconIcon } from '@jupyterlab/ui-components';
 import { PromiseDelegate } from '@lumino/coreutils';
 import { DisposableDelegate } from '@lumino/disposable';
@@ -38,12 +38,9 @@
 import { notificationPlugin } from './notificationplugin';
 import { Palette } from './palette';
 import { settingsPlugin } from './settingsplugin';
-import { kernelStatus, runningSessionsStatus } from './statusbarplugin';
 import { themesPaletteMenuPlugin, themesPlugin } from './themesplugins';
 import { toolbarRegistry } from './toolbarregistryplugin';
 import { workspacesPlugin } from './workspacesplugin';
-import { IRenderMime } from '@jupyterlab/rendermime-interfaces';
-import { displayShortcuts } from './shortcuts';
 
 /**
  * The interval in milliseconds before recover options appear during splash.
@@ -67,8 +64,6 @@
   export const runAllEnabled = 'apputils:run-all-enabled';
 
   export const toggleHeader = 'apputils:toggle-header';
-
-  export const displayShortcuts = 'apputils:display-shortcuts';
 }
 
 /**
@@ -76,7 +71,6 @@
  */
 const palette: JupyterFrontEndPlugin<ICommandPalette> = {
   id: '@jupyterlab/apputils-extension:palette',
-  description: 'Provides the command palette.',
   autoStart: true,
   requires: [ITranslator],
   provides: ICommandPalette,
@@ -101,7 +95,6 @@
  */
 const paletteRestorer: JupyterFrontEndPlugin<void> = {
   id: '@jupyterlab/apputils-extension:palette-restorer',
-  description: 'Restores the command palette.',
   autoStart: true,
   requires: [ILayoutRestorer, ITranslator],
   activate: (
@@ -118,7 +111,6 @@
  */
 const resolver: JupyterFrontEndPlugin<IWindowResolver> = {
   id: '@jupyterlab/apputils-extension:resolver',
-  description: 'Provides the window name resolver.',
   autoStart: true,
   provides: IWindowResolver,
   requires: [JupyterFrontEnd.IPaths, IRouter],
@@ -168,7 +160,6 @@
  */
 const splash: JupyterFrontEndPlugin<ISplashScreen> = {
   id: '@jupyterlab/apputils-extension:splash',
-  description: 'Provides the splash screen.',
   autoStart: true,
   requires: [ITranslator],
   provides: ISplashScreen,
@@ -281,7 +272,6 @@
 
 const print: JupyterFrontEndPlugin<void> = {
   id: '@jupyterlab/apputils-extension:print',
-  description: 'Add the print capability',
   autoStart: true,
   requires: [ITranslator],
   activate: (app: JupyterFrontEnd, translator: ITranslator) => {
@@ -300,16 +290,11 @@
         }
       }
     });
-
-    app.shell.currentChanged?.connect(() => {
-      app.commands.notifyCommandChanged(CommandIDs.print);
-    });
   }
 };
 
 export const toggleHeader: JupyterFrontEndPlugin<void> = {
   id: '@jupyterlab/apputils-extension:toggle-header',
-  description: 'Adds a command to display the main area widget content header.',
   autoStart: true,
   requires: [ITranslator],
   optional: [ICommandPalette],
@@ -325,7 +310,6 @@
       label: trans.__('Show Header Above Content'),
       isEnabled: () =>
         app.shell.currentWidget instanceof MainAreaWidget &&
-        !app.shell.currentWidget.contentHeader.isDisposed &&
         app.shell.currentWidget.contentHeader.widgets.length > 0,
       isToggled: () => {
         const widget = app.shell.currentWidget;
@@ -340,11 +324,6 @@
         }
       }
     });
-
-    app.shell.currentChanged?.connect(() => {
-      app.commands.notifyCommandChanged(CommandIDs.toggleHeader);
-    });
-
     if (palette) {
       palette.addItem({ command: CommandIDs.toggleHeader, category });
     }
@@ -399,7 +378,6 @@
  */
 const state: JupyterFrontEndPlugin<IStateDB> = {
   id: '@jupyterlab/apputils-extension:state',
-  description: 'Provides the application state. It is stored per workspaces.',
   autoStart: true,
   provides: IStateDB,
   requires: [JupyterFrontEnd.IPaths, IRouter, ITranslator],
@@ -435,7 +413,6 @@
     db.changed.connect(() => updateTabTitle(workspace, db, name));
 
     commands.addCommand(CommandIDs.loadState, {
-      label: trans.__('Load state for the current workspace.'),
       execute: async (args: IRouter.ILocation) => {
         // Since the command can be executed an arbitrary number of times, make
         // sure it is safe to call multiple times.
@@ -510,7 +487,6 @@
     });
 
     commands.addCommand(CommandIDs.resetOnLoad, {
-      label: trans.__('Reset state when loading for the workspace.'),
       execute: (args: IRouter.ILocation) => {
         const { hash, path, search } = args;
         const query = URLExt.queryStringToObject(search || '');
@@ -573,14 +549,10 @@
  */
 const sessionDialogs: JupyterFrontEndPlugin<ISessionContextDialogs> = {
   id: '@jupyterlab/apputils-extension:sessionDialogs',
-  description: 'Provides the session context dialogs.',
   provides: ISessionContextDialogs,
-  optional: [ITranslator],
-  autoStart: true,
-  activate: async (app: JupyterFrontEnd, translator: ITranslator | null) => {
-    return new SessionContextDialogs({
-      translator: translator ?? nullTranslator
-    });
+  autoStart: true,
+  activate: () => {
+    return sessionContextDialogs;
   }
 };
 
@@ -589,15 +561,9 @@
  */
 const utilityCommands: JupyterFrontEndPlugin<void> = {
   id: '@jupyterlab/apputils-extension:utilityCommands',
-  description: 'Adds meta commands to run set of other commands.',
   requires: [ITranslator],
-  optional: [ICommandPalette],
-  autoStart: true,
-  activate: (
-    app: JupyterFrontEnd,
-    translator: ITranslator,
-    palette: ICommandPalette | null
-  ) => {
+  autoStart: true,
+  activate: (app: JupyterFrontEnd, translator: ITranslator) => {
     const trans = translator.load('jupyterlab');
     const { commands } = app;
     commands.addCommand(CommandIDs.runFirstEnabled, {
@@ -616,16 +582,13 @@
       }
     });
 
-    // Add a command for taking lists of commands and command arguments
-    // and running all the enabled commands.
     commands.addCommand(CommandIDs.runAllEnabled, {
       label: trans.__('Run All Enabled Commands Passed as Args'),
       execute: async args => {
-        const commands: string[] = (args.commands as string[]) ?? [];
+        const commands: string[] = args.commands as string[];
         const commandArgs: any = args.args;
         const argList = Array.isArray(args);
-        const errorIfNotEnabled: boolean =
-          (args.errorIfNotEnabled as boolean) ?? false;
+        const errorIfNotEnabled: boolean = args.errorIfNotEnabled as boolean;
         for (let i = 0; i < commands.length; i++) {
           const cmd = commands[i];
           const arg = argList ? commandArgs[i] : commandArgs;
@@ -637,62 +600,25 @@
             }
           }
         }
-      },
-      isEnabled: args => {
-        const commands: string[] = (args.commands as string[]) ?? [];
-        const commandArgs: any = args.args;
-        const argList = Array.isArray(args);
-
-        return commands.some((cmd, idx) =>
-          app.commands.isEnabled(cmd, argList ? commandArgs[idx] : commandArgs)
-        );
-      }
-    });
-
-    commands.addCommand(CommandIDs.displayShortcuts, {
-      label: trans.__('Show Keyboard Shortcutsâ€¦'),
-      caption: trans.__(
-        'Show relevant keyboard shortcuts for the current active widget'
-      ),
-      execute: args => {
-        const currentWidget = app.shell.currentWidget;
-        const included = currentWidget?.node.contains(document.activeElement);
-
-        if (!included && currentWidget instanceof MainAreaWidget) {
-          const currentNode = currentWidget.content.node ?? currentWidget?.node;
-          currentNode?.focus();
-        }
-        const options = { commands, trans };
-        return displayShortcuts(options);
-      }
-    });
-
-    if (palette) {
-      const category: string = trans.__('Help');
-      palette.addItem({ command: CommandIDs.displayShortcuts, category });
-    }
+      }
+    });
   }
 };
 
 /**
  * The default HTML sanitizer.
  */
-const sanitizer: JupyterFrontEndPlugin<IRenderMime.ISanitizer> = {
-  id: '@jupyterlab/apputils-extension:sanitizer',
-  description: 'Provides the HTML sanitizer.',
+const sanitizer: JupyterFrontEndPlugin<ISanitizer> = {
+  id: '@jupyter/apputils-extension:sanitizer',
   autoStart: true,
   provides: ISanitizer,
   requires: [ISettingRegistry],
-  activate: (
-    app: JupyterFrontEnd,
-    settings: ISettingRegistry
-  ): IRenderMime.ISanitizer => {
+  activate: (app: JupyterFrontEnd, settings: ISettingRegistry): ISanitizer => {
     const sanitizer = new Sanitizer();
     const loadSetting = (setting: ISettingRegistry.ISettings): void => {
-      const allowedSchemes = setting.get('allowedSchemes')
-        .composite as Array<string>;
-
-      const autolink = setting.get('autolink').composite as boolean;
+      const allowedSchemes = setting.get('allowedSchemes').composite as Array<
+        string
+      >;
       const allowNamedProperties = setting.get('allowNamedProperties')
         .composite as boolean;
 
@@ -700,7 +626,6 @@
         sanitizer.setAllowedSchemes(allowedSchemes);
       }
 
-      sanitizer.setAutolink(autolink);
       sanitizer.setAllowNamedProperties(allowNamedProperties);
     };
 
@@ -728,13 +653,11 @@
  */
 const plugins: JupyterFrontEndPlugin<any>[] = [
   announcements,
-  kernelStatus,
   notificationPlugin,
   palette,
   paletteRestorer,
   print,
   resolver,
-  runningSessionsStatus,
   sanitizer,
   settingsPlugin,
   state,