--- packages\docmanager\src\manager.ts (old)
+++ packages\docmanager\src\manager.ts (new)
@@ -1,8 +1,9 @@
 // Copyright (c) Jupyter Development Team.
 // Distributed under the terms of the Modified BSD License.
 
-import { ISessionContext, SessionContextDialogs } from '@jupyterlab/apputils';
+import { ISessionContext, sessionContextDialogs } from '@jupyterlab/apputils';
 import { IChangedArgs, PathExt } from '@jupyterlab/coreutils';
+import { IDocumentProviderFactory } from '@jupyterlab/docprovider';
 import {
   Context,
   DocumentRegistry,
@@ -17,11 +18,7 @@
 import { ISignal, Signal } from '@lumino/signaling';
 import { Widget } from '@lumino/widgets';
 import { SaveHandler } from './savehandler';
-import {
-  IDocumentManager,
-  IDocumentWidgetOpener,
-  IRecentsManager
-} from './tokens';
+import { IDocumentManager } from './tokens';
 import { DocumentWidgetManager } from './widgetmanager';
 
 /**
@@ -42,18 +39,15 @@
     this.translator = options.translator || nullTranslator;
     this.registry = options.registry;
     this.services = options.manager;
-    this._dialogs =
-      options.sessionDialogs ??
-      new SessionContextDialogs({ translator: options.translator });
-    this._isConnectedCallback = options.isConnectedCallback || (() => true);
+    this._dialogs = options.sessionDialogs || sessionContextDialogs;
+    this._docProviderFactory = options.docProviderFactory;
 
     this._opener = options.opener;
     this._when = options.when || options.manager.ready;
 
     const widgetManager = new DocumentWidgetManager({
       registry: this.registry,
-      translator: this.translator,
-      recentsManager: options.recentsManager
+      translator: this.translator
     });
     widgetManager.activateRequested.connect(this._onActivateRequested, this);
     widgetManager.stateChanged.connect(this._onWidgetStateChanged, this);
@@ -349,18 +343,6 @@
   }
 
   /**
-   * Duplicate a file.
-   *
-   * @param path - The full path to the file to be duplicated.
-   *
-   * @returns A promise which resolves when the file is duplicated.
-   */
-  duplicate(path: string): Promise<Contents.IModel> {
-    const basePath = PathExt.dirname(path);
-    return this.services.contents.copy(path, basePath);
-  }
-
-  /**
    * See if a widget already exists for the given path and widget name.
    *
    * @param path - The file path to use.
@@ -470,13 +452,10 @@
   ): IDocumentWidget | undefined {
     const widget = this.findWidget(path, widgetName);
     if (widget) {
-      this._opener.open(widget, {
-        type: widgetName,
-        ...options
-      });
+      this._opener.open(widget, options || {});
       return widget;
     }
-    return this.open(path, widgetName, kernel, options ?? {});
+    return this.open(path, widgetName, kernel, options || {});
   }
 
   /**
@@ -564,23 +543,25 @@
       options?: DocumentRegistry.IOpenOptions
     ) => {
       this._widgetManager.adoptWidget(context, widget);
-      // TODO should we pass the type for layout customization
       this._opener.open(widget, options);
     };
+    const modelDBFactory =
+      this.services.contents.getModelDBFactory(path) || undefined;
     const context = new Context({
       opener: adopter,
       manager: this.services,
       factory,
       path,
       kernelPreference,
+      modelDBFactory,
       setBusy: this._setBusy,
       sessionDialogs: this._dialogs,
+      docProviderFactory: this._docProviderFactory,
       lastModifiedCheckMargin: this._lastModifiedCheckMargin,
       translator: this.translator
     });
     const handler = new SaveHandler({
       context,
-      isConnectedCallback: this._isConnectedCallback,
       saveInterval: this.autosaveInterval
     });
     Private.saveHandlerProperty.set(context, handler);
@@ -673,7 +654,7 @@
     }
 
     const widget = this._widgetManager.createWidget(widgetFactory, context);
-    this._opener.open(widget, { type: widgetFactory.name, ...options });
+    this._opener.open(widget, options || {});
 
     // If the initial opening of the context fails, dispose of the widget.
     ready.catch(err => {
@@ -709,7 +690,7 @@
   protected translator: ITranslator;
   private _activateRequested = new Signal<this, string>(this);
   private _contexts: Private.IContext[] = [];
-  private _opener: IDocumentWidgetOpener;
+  private _opener: DocumentManager.IWidgetOpener;
   private _widgetManager: DocumentWidgetManager;
   private _isDisposed = false;
   private _autosave = true;
@@ -719,7 +700,7 @@
   private _when: Promise<void>;
   private _setBusy: (() => IDisposable) | undefined;
   private _dialogs: ISessionContext.IDialogs;
-  private _isConnectedCallback: () => boolean;
+  private _docProviderFactory: IDocumentProviderFactory | undefined;
   private _stateChanged = new Signal<DocumentManager, IChangedArgs<any>>(this);
 }
 
@@ -744,7 +725,7 @@
     /**
      * A widget opener for sibling widgets.
      */
-    opener: IDocumentWidgetOpener;
+    opener: IWidgetOpener;
 
     /**
      * A promise for when to start using the manager.
@@ -767,15 +748,31 @@
     translator?: ITranslator;
 
     /**
-     * Autosaving should be paused while this callback function returns `false`.
-     * By default, it always returns `true`.
-     */
-    isConnectedCallback?: () => boolean;
-
-    /**
-     * The manager for recent documents.
-     */
-    recentsManager?: IRecentsManager;
+     * A factory method for the document provider.
+     */
+    docProviderFactory?: IDocumentProviderFactory;
+
+    /**
+     * Whether the context should be collaborative.
+     *
+     * @deprecated It will be removed in 4.0.0. The collaborative feature
+     * is provided by the `DocumentRegistry.IModel` (can be customized by the
+     * `DocumentRegistry.IModelFactory`)
+     */
+    collaborative?: boolean;
+  }
+
+  /**
+   * An interface for a widget opener.
+   */
+  export interface IWidgetOpener {
+    /**
+     * Open the given widget.
+     */
+    open(
+      widget: IDocumentWidget,
+      options?: DocumentRegistry.IOpenOptions
+    ): void;
   }
 }
 