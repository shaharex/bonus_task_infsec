--- packages\apputils\src\tokens.ts (old)
+++ packages\apputils\src\tokens.ts (new)
@@ -2,95 +2,35 @@
 // Distributed under the terms of the Modified BSD License.
 
 import { IChangedArgs } from '@jupyterlab/coreutils';
-import { IRenderMime } from '@jupyterlab/rendermime-interfaces';
 import { ISettingRegistry } from '@jupyterlab/settingregistry';
 import { Token } from '@lumino/coreutils';
 import { IDisposable } from '@lumino/disposable';
 import { ISignal } from '@lumino/signaling';
-import { CommandPalette, Widget } from '@lumino/widgets';
+import { Widget } from '@lumino/widgets';
 import { ISessionContext } from './sessioncontext';
 
 /**
- * The command palette token.
- */
-export const ICommandPalette = new Token<ICommandPalette>(
-  '@jupyterlab/apputils:ICommandPalette',
-  `A service for the application command palette
-  in the left panel. Use this to add commands to the palette.`
-);
-
-/**
- * The options for creating a command palette item.
- */
-export interface IPaletteItem extends CommandPalette.IItemOptions {}
-
-/**
- * The interface for a Jupyter Lab command palette.
- */
-export interface ICommandPalette {
-  /**
-   * The placeholder text of the command palette's search input.
-   */
-  placeholder: string;
-
-  /**
-   * Activate the command palette for user input.
-   */
-  activate(): void;
-
-  /**
-   * Add a command item to the command palette.
-   *
-   * @param options - The options for creating the command item.
-   *
-   * @returns A disposable that will remove the item from the palette.
-   */
-  addItem(options: IPaletteItem): IDisposable;
-}
-
-/**
- * The kernel status indicator model.
- */
-export const IKernelStatusModel = new Token<IKernelStatusModel>(
-  '@jupyterlab/apputils:IKernelStatusModel',
-  'A service to register kernel session provider to the kernel status indicator.'
-);
-
-/**
- * Kernel status indicator model.
- */
-export interface IKernelStatusModel {
-  /**
-   * Add a session context provider.
-   *
-   * A provider will receive the currently active widget and must return the
-   * associated session context if it can or null otherwise.
-   */
-  addSessionProvider: (
-    provider: (widget: Widget | null) => ISessionContext | null
-  ) => void;
-}
-
-/**
  * An interface for the session context dialogs.
  */
 export interface ISessionContextDialogs extends ISessionContext.IDialogs {}
 
+/* tslint:disable */
 /**
  * The session context dialogs token.
  */
 export const ISessionContextDialogs = new Token<ISessionContext.IDialogs>(
-  '@jupyterlab/apputils:ISessionContextDialogs',
-  'A service for handling the session dialogs.'
-);
-
+  '@jupyterlab/apputils:ISessionContextDialogs'
+);
+/* tslint:enable */
+
+/* tslint:disable */
 /**
  * The theme manager token.
  */
 export const IThemeManager = new Token<IThemeManager>(
-  '@jupyterlab/apputils:IThemeManager',
-  'A service for the theme manager for the application. This is used primarily in theme extensions to register new themes.'
-);
+  '@jupyterlab/apputils:IThemeManager'
+);
+/* tslint:enable */
 
 /**
  * An interface for a theme manager.
@@ -102,34 +42,9 @@
   readonly theme: string | null;
 
   /**
-   * Get the name of the preferred light theme.
-   */
-  readonly preferredLightTheme?: string | undefined;
-
-  /**
-   * Get the name of the preferred dark theme.
-   */
-  readonly preferredDarkTheme?: string | undefined;
-
-  /**
-   * Get the name of the preferred theme.
-   */
-  readonly preferredTheme?: string | null | undefined;
-
-  /**
    * The names of the registered themes.
    */
   readonly themes: ReadonlyArray<string>;
-
-  /**
-   * Get the names of the registered light themes.
-   */
-  readonly lightThemes?: ReadonlyArray<string> | undefined;
-
-  /**
-   * Get the names of the registered dark themes.
-   */
-  readonly darkThemes?: ReadonlyArray<string> | undefined;
 
   /**
    * A signal fired when the application theme changes.
@@ -224,15 +139,22 @@
 /**
  * The sanitizer token.
  */
-export const ISanitizer = new Token<IRenderMime.ISanitizer>(
-  '@jupyterlab/apputils:ISanitizer',
-  'A service for sanitizing HTML strings.'
-);
-
-/**
- * @deprecated since v4 use {@link IRenderMime.ISanitizer}
- */
-export type ISanitizer = IRenderMime.ISanitizer;
+export const ISanitizer = new Token<ISanitizer>(
+  '@jupyterlab/apputils:ISanitizer'
+);
+
+export interface ISanitizer {
+  /**
+   * Sanitize an HTML string.
+   *
+   * @param dirty - The dirty text.
+   *
+   * @param options - The optional sanitization options.
+   *
+   * @returns The sanitized string.
+   */
+  sanitize(dirty: string, options?: ISanitizer.IOptions): string;
+}
 
 /**
  * The namespace for `ISanitizer` related interfaces.
@@ -240,53 +162,23 @@
 export namespace ISanitizer {
   /**
    * The options used to sanitize.
-   *
-   * @deprecated in v4 use {@link IRenderMime.ISanitizerOptions}
-   */
-  export type IOptions = IRenderMime.ISanitizerOptions;
-}
-
-/**
- * The main menu token.
- */
-export const ISplashScreen = new Token<ISplashScreen>(
-  '@jupyterlab/apputils:ISplashScreen',
-  `A service for the splash screen for the application.
-  Use this if you want to show the splash screen for your own purposes.`
-);
-
-/**
- * The interface for an application splash screen.
- */
-export interface ISplashScreen {
-  /**
-   * Show the application splash screen.
-   *
-   * @param light - Whether to show the light splash screen or the dark one.
-   *
-   * @returns A disposable used to clear the splash screen.
-   */
-  show(light?: boolean): IDisposable;
-}
-
-/**
- * The default window resolver token.
- */
-export const IWindowResolver = new Token<IWindowResolver>(
-  '@jupyterlab/apputils:IWindowResolver',
-  `A service for a window resolver for the
-  application. JupyterLab workspaces are given a name, which are determined using
-  the window resolver. Require this if you want to use the name of the current workspace.`
-);
-
-/**
- * The description of a window name resolver.
- */
-export interface IWindowResolver {
-  /**
-   * A window name to use as a handle among shared resources.
-   */
-  readonly name: string;
+   */
+  export interface IOptions {
+    /**
+     * The allowed tags.
+     */
+    allowedTags?: string[];
+
+    /**
+     * The allowed attributes for a given tag.
+     */
+    allowedAttributes?: { [key: string]: string[] };
+
+    /**
+     * The allowed style values for a given tag.
+     */
+    allowedStyles?: { [key: string]: { [key: string]: RegExp[] } };
+  }
 }
 
 /**
@@ -296,7 +188,16 @@
   /**
    * Interface of item to be inserted in a toolbar
    */
-  export interface IToolbarItem extends IRenderMime.IToolbarItem {}
+  export interface IToolbarItem {
+    /**
+     * Unique item name
+     */
+    name: string;
+    /**
+     * Toolbar widget
+     */
+    widget: Widget;
+  }
 
   /**
    * Interface describing a toolbar item widget
@@ -329,20 +230,6 @@
  */
 export interface IToolbarWidgetRegistry {
   /**
-   * Add a new toolbar item factory
-   *
-   * @param widgetFactory The widget factory name that creates the toolbar
-   * @param toolbarItemName The unique toolbar item
-   * @param factory The factory function that receives the widget containing the toolbar and returns the toolbar widget.
-   * @returns The previously defined factory
-   */
-  addFactory<T extends Widget = Widget>(
-    widgetFactory: string,
-    toolbarItemName: string,
-    factory: (main: T) => Widget
-  ): ((main: T) => Widget) | undefined;
-
-  /**
    * Default toolbar item factory
    */
   defaultFactory: (
@@ -372,26 +259,17 @@
    * @param toolbarItemName The unique toolbar item
    * @param factory The factory function that receives the widget containing the toolbar and returns the toolbar widget.
    * @returns The previously defined factory
-   *
-   * @deprecated since v4 use `addFactory` instead
    */
   registerFactory<T extends Widget = Widget>(
     widgetFactory: string,
     toolbarItemName: string,
     factory: (main: T) => Widget
   ): ((main: T) => Widget) | undefined;
-
-  /**
-   * A signal emitted when a factory widget has been added.
-   */
-  readonly factoryAdded: ISignal<this, string>;
 }
 
 /**
  * The toolbar registry token.
  */
 export const IToolbarWidgetRegistry = new Token<IToolbarWidgetRegistry>(
-  '@jupyterlab/apputils:IToolbarWidgetRegistry',
-  `A registry for toolbar widgets. Require this
-  if you want to build the toolbar dynamically from a data definition (stored in settings for example).`
-);
+  '@jupyterlab/apputils:IToolbarWidgetRegistry'
+);