--- packages\settingeditor\src\raweditor.ts (old)
+++ packages\settingeditor\src\raweditor.ts (new)
@@ -1,16 +1,17 @@
 // Copyright (c) Jupyter Development Team.
 // Distributed under the terms of the Modified BSD License.
 
+import { CommandToolbarButton, Toolbar } from '@jupyterlab/apputils';
 import { CodeEditor, CodeEditorWrapper } from '@jupyterlab/codeeditor';
 import { IRenderMimeRegistry } from '@jupyterlab/rendermime';
 import { ISettingRegistry } from '@jupyterlab/settingregistry';
 import { ITranslator, nullTranslator } from '@jupyterlab/translation';
-import { CommandToolbarButton, Toolbar } from '@jupyterlab/ui-components';
 import { CommandRegistry } from '@lumino/commands';
 import { Message } from '@lumino/messaging';
 import { ISignal, Signal } from '@lumino/signaling';
-import { BoxLayout, SplitPanel, Widget } from '@lumino/widgets';
+import { BoxLayout, Widget } from '@lumino/widgets';
 import { createInspector } from './inspector';
+import { SplitPanel } from './splitpanel';
 
 /**
  * A class name added to all raw editors.
@@ -48,24 +49,24 @@
 
     // Create read-only defaults editor.
     const defaults = (this._defaults = new CodeEditorWrapper({
-      editorOptions: {
-        config: { readOnly: true }
-      },
-      model: new CodeEditor.Model({ mimeType: 'text/javascript' }),
+      model: new CodeEditor.Model(),
       factory: editorFactory
     }));
 
+    defaults.editor.model.value.text = '';
+    defaults.editor.model.mimeType = 'text/javascript';
+    defaults.editor.setOption('readOnly', true);
+
     // Create read-write user settings editor.
     const user = (this._user = new CodeEditorWrapper({
-      editorOptions: {
-        config: { lineNumbers: true }
-      },
-      model: new CodeEditor.Model({ mimeType: 'text/javascript' }),
-      factory: editorFactory
+      model: new CodeEditor.Model(),
+      factory: editorFactory,
+      config: { lineNumbers: true }
     }));
 
     user.addClass(USER_CLASS);
-    user.editor.model.sharedModel.changed.connect(this._onTextChanged, this);
+    user.editor.model.mimeType = 'text/javascript';
+    user.editor.model.value.changed.connect(this._onTextChanged, this);
 
     // Create and set up an inspector.
     this._inspector = createInspector(
@@ -75,6 +76,7 @@
     );
 
     this.addClass(RAW_EDITOR_CLASS);
+    // FIXME-TRANS: onSaveError must have an optional translator?
     this._onSaveError = options.onSaveError;
     this.addWidget(Private.defaultsEditor(defaults, this.translator));
     this.addWidget(
@@ -112,10 +114,7 @@
    * Tests whether the settings have been modified and need saving.
    */
   get isDirty(): boolean {
-    return (
-      this._user.editor.model.sharedModel.getSource() !== this._settings?.raw ??
-      ''
-    );
+    return this._user.editor.model.value.text !== this._settings?.raw ?? '';
   }
 
   /**
@@ -150,8 +149,8 @@
       this._onSettingsChanged();
     } else {
       this._settings = null;
-      defaults.editor.model.sharedModel.setSource('');
-      user.editor.model.sharedModel.setSource('');
+      defaults.editor.model.value.text = '';
+      user.editor.model.value.text = '';
     }
 
     this.update();
@@ -182,18 +181,16 @@
       return;
     }
 
-    this._defaults.model.dispose();
+    super.dispose();
     this._defaults.dispose();
-    this._user.model.dispose();
     this._user.dispose();
-    super.dispose();
   }
 
   /**
    * Revert the editor back to original settings.
    */
   revert(): void {
-    this._user.editor.model.sharedModel.setSource(this.settings?.raw ?? '');
+    this._user.editor.model.value.text = this.settings?.raw ?? '';
     this._updateToolbar(false, false);
   }
 
@@ -206,7 +203,7 @@
     }
 
     const settings = this._settings;
-    const source = this._user.editor.model.sharedModel.getSource();
+    const source = this._user.editor.model.value.text;
 
     return settings
       .save(source)
@@ -228,10 +225,24 @@
   }
 
   /**
+   * Handle `'update-request'` messages.
+   */
+  protected onUpdateRequest(msg: Message): void {
+    const settings = this._settings;
+    const defaults = this._defaults;
+    const user = this._user;
+
+    if (settings) {
+      defaults.editor.refresh();
+      user.editor.refresh();
+    }
+  }
+
+  /**
    * Handle text changes in the underlying editor.
    */
   private _onTextChanged(): void {
-    const raw = this._user.editor.model.sharedModel.getSource();
+    const raw = this._user.editor.model.value.text;
     const settings = this._settings;
 
     this.removeClass(ERROR_CLASS);
@@ -261,10 +272,8 @@
     const defaults = this._defaults;
     const user = this._user;
 
-    defaults.editor.model.sharedModel.setSource(
-      settings?.annotatedDefaults() ?? ''
-    );
-    user.editor.model.sharedModel.setSource(settings?.raw ?? '');
+    defaults.editor.model.value.text = settings?.annotatedDefaults() ?? '';
+    user.editor.model.value.text = settings?.raw ?? '';
   }
 
   private _updateToolbar(revert = this._canRevert, save = this._canSave): void {
@@ -329,7 +338,7 @@
     /**
      * A function the raw editor calls on save errors.
      */
-    onSaveError: (reason: any, translator?: ITranslator) => void;
+    onSaveError: (reason: any) => void;
 
     /**
      * The setting registry used by the editor.