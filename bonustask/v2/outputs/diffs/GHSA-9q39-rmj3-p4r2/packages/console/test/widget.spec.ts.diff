--- packages\console\test\widget.spec.ts (old)
+++ packages\console\test\widget.spec.ts (new)
@@ -2,18 +2,16 @@
 // Distributed under the terms of the Modified BSD License.
 
 import { SessionContext } from '@jupyterlab/apputils';
-import { createSessionContext } from '@jupyterlab/apputils/lib/testutils';
 import {
   CodeCell,
   CodeCellModel,
   RawCell,
   RawCellModel
 } from '@jupyterlab/cells';
-import { createStandaloneCell, YCodeCell } from '@jupyter/ydoc';
-import { NBTestUtils } from '@jupyterlab/cells/lib/testutils';
-import { CodeConsole } from '@jupyterlab/console';
+import { createSessionContext, NBTestUtils } from '@jupyterlab/testutils';
 import { Message, MessageLoop } from '@lumino/messaging';
 import { Widget } from '@lumino/widgets';
+import { CodeConsole } from '../src';
 import {
   createConsoleFactory,
   editorFactory,
@@ -144,7 +142,7 @@
     describe('#addCell()', () => {
       it('should add a code cell to the content widget', () => {
         const contentFactory = NBTestUtils.createCodeCellFactory();
-        const model = new CodeCellModel();
+        const model = new CodeCellModel({});
         const cell = new CodeCell({
           model,
           contentFactory,
@@ -166,7 +164,7 @@
         expect(widget.cells.length).toBeGreaterThan(0);
         widget.clear();
         expect(widget.cells.length).toBe(0);
-        expect(widget.promptCell!.model.sharedModel.getSource()).toBe('');
+        expect(widget.promptCell!.model.value.text).toBe('');
       });
     });
 
@@ -201,7 +199,7 @@
         const force = false;
         const timeout = 9000;
         Widget.attach(widget, document.body);
-        widget.promptCell!.model.sharedModel.setSource('for x in range(5):');
+        widget.promptCell!.model.value.text = 'for x in range(5):';
         expect(widget.cells.length).toBe(0);
         const session = widget.sessionContext as SessionContext;
         session.kernelPreference = { name: 'ipython' };
@@ -226,16 +224,16 @@
         Widget.attach(widget, document.body);
 
         const model = widget.promptCell!.model;
-        expect(model.sharedModel.getSource()).toHaveLength(0);
+        expect(model.value.text).toHaveLength(0);
         widget.insertLinebreak();
-        expect(model.sharedModel.getSource()).toBe('\n');
+        expect(model.value.text).toBe('\n');
       });
     });
 
     describe('#serialize()', () => {
       it('should serialize the contents of a console', () => {
         Widget.attach(widget, document.body);
-        widget.promptCell!.model.sharedModel.setSource('foo');
+        widget.promptCell!.model.value.text = 'foo';
 
         const serialized = widget.serialize();
         expect(serialized).toHaveLength(1);
@@ -280,19 +278,6 @@
           expect.arrayContaining(['newPromptCell'])
         );
       });
-
-      it('should make previous cell read-only after execution', async () => {
-        Widget.attach(widget, document.body);
-
-        const old = widget.promptCell;
-        const force = true;
-        expect(old).toBeInstanceOf(CodeCell);
-
-        await (widget.sessionContext as SessionContext).initialize();
-        await widget.execute(force);
-
-        expect(old!.editor!.getOption('readOnly')).toBe(true);
-      });
     });
 
     describe('#onActivateRequest()', () => {
@@ -306,7 +291,7 @@
         expect(widget.methods).toEqual(
           expect.arrayContaining(['onActivateRequest'])
         );
-        expect(widget.promptCell!.editor!.hasFocus()).toBe(true);
+        expect(widget.promptCell!.editor.hasFocus()).toBe(true);
       });
     });
 
@@ -334,7 +319,7 @@
 
       describe('#createCodeCell', () => {
         it('should create a code cell', () => {
-          const model = new CodeCellModel();
+          const model = new CodeCellModel({});
           const prompt = contentFactory.createCodeCell({
             rendermime: widget.rendermime,
             model,
@@ -346,7 +331,7 @@
 
       describe('#createRawCell', () => {
         it('should create a foreign cell', () => {
-          const model = new RawCellModel();
+          const model = new RawCellModel({});
           const prompt = contentFactory.createRawCell({
             model,
             contentFactory
@@ -384,13 +369,7 @@
       describe('#createCodeCell()', () => {
         it('should create a code cell', () => {
           const factory = new CodeConsole.ModelFactory({});
-          expect(
-            factory.createCodeCell({
-              sharedModel: createStandaloneCell({
-                cell_type: 'code'
-              }) as YCodeCell
-            })
-          ).toBeInstanceOf(CodeCellModel);
+          expect(factory.createCodeCell({})).toBeInstanceOf(CodeCellModel);
         });
       });
 