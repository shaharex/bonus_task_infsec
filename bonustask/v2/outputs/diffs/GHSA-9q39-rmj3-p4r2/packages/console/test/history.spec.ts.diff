--- packages\console\test\history.spec.ts (old)
+++ packages\console\test\history.spec.ts (new)
@@ -2,15 +2,13 @@
 // Distributed under the terms of the Modified BSD License.
 
 import { ISessionContext } from '@jupyterlab/apputils';
-import { createSessionContext } from '@jupyterlab/apputils/lib/testutils';
 import { CodeEditor } from '@jupyterlab/codeeditor';
-import { CodeMirrorEditor, ybinding } from '@jupyterlab/codemirror';
-import { ConsoleHistory } from '@jupyterlab/console';
+import { CodeMirrorEditor } from '@jupyterlab/codemirror';
 import { KernelMessage } from '@jupyterlab/services';
-import { createStandaloneCell } from '@jupyter/ydoc';
-import { signalToPromise } from '@jupyterlab/testing';
+import { createSessionContext, signalToPromise } from '@jupyterlab/testutils';
+import { ConsoleHistory } from '../src';
 
-const mockHistory = {
+const mockHistory = ({
   header: null,
   parent_header: {
     date: '',
@@ -32,7 +30,7 @@
       [0, 0, 'qux']
     ]
   }
-} as unknown as KernelMessage.IHistoryReplyMsg;
+} as unknown) as KernelMessage.IHistoryReplyMsg;
 
 class TestHistory extends ConsoleHistory {
   methods: string[] = [];
@@ -163,17 +161,11 @@
         expect(history.methods).toEqual(
           expect.not.arrayContaining(['onTextChange'])
         );
-        const model = new CodeEditor.Model({
-          sharedModel: createStandaloneCell({ cell_type: 'code' })
-        });
+        const model = new CodeEditor.Model();
         const host = document.createElement('div');
-        const editor = new CodeMirrorEditor({
-          model,
-          host,
-          extensions: [ybinding({ ytext: (model.sharedModel as any).ysource })]
-        });
+        const editor = new CodeMirrorEditor({ model, host });
         history.editor = editor;
-        model.sharedModel.setSource('foo');
+        model.value.text = 'foo';
         expect(history.methods).toEqual(
           expect.arrayContaining(['onTextChange'])
         );
@@ -187,23 +179,17 @@
           expect.not.arrayContaining(['onEdgeRequest'])
         );
         const host = document.createElement('div');
-        const model = new CodeEditor.Model({
-          sharedModel: createStandaloneCell({ cell_type: 'code' })
-        });
-        const editor = new CodeMirrorEditor({
-          model,
-          host,
-          extensions: [ybinding({ ytext: (model.sharedModel as any).ysource })]
-        });
+        const model = new CodeEditor.Model();
+        const editor = new CodeMirrorEditor({ model, host });
         history.editor = editor;
         history.push('foo');
-        const promise = signalToPromise(editor.model.sharedModel.changed);
+        const promise = signalToPromise(editor.model.value.changed);
         editor.edgeRequested.emit('top');
         expect(history.methods).toEqual(
           expect.arrayContaining(['onEdgeRequest'])
         );
         await promise;
-        expect(editor.model.sharedModel.getSource()).toBe('foo');
+        expect(editor.model.value.text).toBe('foo');
       });
     });
   });