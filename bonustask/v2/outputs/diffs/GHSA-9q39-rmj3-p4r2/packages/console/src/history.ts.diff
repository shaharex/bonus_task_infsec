--- packages\console\src\history.ts (old)
+++ packages\console\src\history.ts (new)
@@ -14,7 +14,7 @@
   /**
    * The session context used by the foreign handler.
    */
-  readonly sessionContext: ISessionContext | null;
+  readonly sessionContext: ISessionContext;
 
   /**
    * The current editor used by the history widget.
@@ -74,18 +74,15 @@
    * Construct a new console history object.
    */
   constructor(options: ConsoleHistory.IOptions) {
-    const { sessionContext } = options;
-    if (sessionContext) {
-      this.sessionContext = sessionContext;
-      void this._handleKernel();
-      this.sessionContext.kernelChanged.connect(this._handleKernel, this);
-    }
+    this.sessionContext = options.sessionContext;
+    void this._handleKernel();
+    this.sessionContext.kernelChanged.connect(this._handleKernel, this);
   }
 
   /**
    * The client session used by the foreign handler.
    */
-  readonly sessionContext: ISessionContext | null;
+  readonly sessionContext: ISessionContext;
 
   /**
    * The current editor used by the history manager.
@@ -101,14 +98,14 @@
     const prev = this._editor;
     if (prev) {
       prev.edgeRequested.disconnect(this.onEdgeRequest, this);
-      prev.model.sharedModel.changed.disconnect(this.onTextChange, this);
+      prev.model.value.changed.disconnect(this.onTextChange, this);
     }
 
     this._editor = value;
 
     if (value) {
       value.edgeRequested.connect(this.onEdgeRequest, this);
-      value.model.sharedModel.changed.connect(this.onTextChange, this);
+      value.model.value.changed.connect(this.onTextChange, this);
     }
   }
 
@@ -253,19 +250,19 @@
     editor: CodeEditor.IEditor,
     location: CodeEditor.EdgeLocation
   ): void {
-    const sharedModel = editor.model.sharedModel;
-    const source = sharedModel.getSource();
+    const model = editor.model;
+    const source = model.value.text;
 
     if (location === 'top' || location === 'topLine') {
       void this.back(source).then(value => {
         if (this.isDisposed || !value) {
           return;
         }
-        if (sharedModel.getSource() === value) {
+        if (model.value.text === value) {
           return;
         }
         this._setByHistory = true;
-        sharedModel.setSource(value);
+        model.value.text = value;
         let columnPos = 0;
         columnPos = value.indexOf('\n');
         if (columnPos < 0) {
@@ -279,11 +276,11 @@
           return;
         }
         const text = value || this.placeholder;
-        if (sharedModel.getSource() === text) {
+        if (model.value.text === text) {
           return;
         }
         this._setByHistory = true;
-        sharedModel.setSource(text);
+        model.value.text = text;
         const pos = editor.getPositionAt(text.length);
         if (pos) {
           editor.setCursorPosition(pos);
@@ -296,7 +293,7 @@
    * Handle the current kernel changing.
    */
   private async _handleKernel(): Promise<void> {
-    const kernel = this.sessionContext?.session?.kernel;
+    const kernel = this.sessionContext.session?.kernel;
     if (!kernel) {
       this._history.length = 0;
       return;
@@ -353,7 +350,7 @@
     /**
      * The client session used by the foreign handler.
      */
-    sessionContext?: ISessionContext;
+    sessionContext: ISessionContext;
   }
 }
 