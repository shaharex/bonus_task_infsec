--- packages\notebook\src\widgetfactory.ts (old)
+++ packages\notebook\src\widgetfactory.ts (new)
@@ -1,14 +1,18 @@
 // Copyright (c) Jupyter Development Team.
 // Distributed under the terms of the Modified BSD License.
 
+import {
+  ISessionContextDialogs,
+  sessionContextDialogs
+} from '@jupyterlab/apputils';
 import { IEditorMimeTypeService } from '@jupyterlab/codeeditor';
 import { ABCWidgetFactory, DocumentRegistry } from '@jupyterlab/docregistry';
 import { IRenderMimeRegistry } from '@jupyterlab/rendermime';
 import { ITranslator } from '@jupyterlab/translation';
+import { ToolbarItems } from './default-toolbar';
 import { INotebookModel } from './model';
 import { NotebookPanel } from './panel';
 import { StaticNotebook } from './widget';
-import { NotebookHistory } from './history';
 
 /**
  * A widget factory for notebook panels.
@@ -25,12 +29,14 @@
   constructor(options: NotebookWidgetFactory.IOptions<NotebookPanel>) {
     super(options);
     this.rendermime = options.rendermime;
-    this.contentFactory = options.contentFactory;
+    this.contentFactory =
+      options.contentFactory || NotebookPanel.defaultContentFactory;
     this.mimeTypeService = options.mimeTypeService;
     this._editorConfig =
       options.editorConfig || StaticNotebook.defaultEditorConfig;
     this._notebookConfig =
       options.notebookConfig || StaticNotebook.defaultNotebookConfig;
+    this._sessionDialogs = options.sessionDialogs || sessionContextDialogs;
   }
 
   /*
@@ -78,11 +84,6 @@
     context: DocumentRegistry.IContext<INotebookModel>,
     source?: NotebookPanel
   ): NotebookPanel {
-    const translator = (context as any).translator;
-    const kernelHistory = new NotebookHistory({
-      sessionContext: context.sessionContext,
-      translator: translator
-    });
     const nbOptions = {
       rendermime: source
         ? source.content.rendermime
@@ -93,16 +94,29 @@
       notebookConfig: source
         ? source.content.notebookConfig
         : this._notebookConfig,
-      translator,
-      kernelHistory
+      translator: this.translator
     };
     const content = this.contentFactory.createNotebook(nbOptions);
 
     return new NotebookPanel({ context, content });
   }
 
+  /**
+   * Default factory for toolbar items to be added after the widget is created.
+   */
+  protected defaultToolbarFactory(
+    widget: NotebookPanel
+  ): DocumentRegistry.IToolbarItem[] {
+    return ToolbarItems.getDefaultItems(
+      widget,
+      this._sessionDialogs,
+      this.translator
+    );
+  }
+
   private _editorConfig: StaticNotebook.IEditorConfig;
   private _notebookConfig: StaticNotebook.INotebookConfig;
+  private _sessionDialogs: ISessionContextDialogs;
 }
 
 /**
@@ -140,6 +154,11 @@
     notebookConfig?: StaticNotebook.INotebookConfig;
 
     /**
+     * The session context dialogs.
+     */
+    sessionDialogs?: ISessionContextDialogs;
+
+    /**
      * The application language translator.
      */
     translator?: ITranslator;
@@ -150,11 +169,6 @@
    */
   export interface IFactory
     extends DocumentRegistry.IWidgetFactory<NotebookPanel, INotebookModel> {
-    /**
-     * Whether to automatically start the preferred kernel.
-     */
-    autoStartDefault: boolean;
-
     /**
      * A configuration object for cell editor settings.
      */