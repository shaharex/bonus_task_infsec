--- packages\extensionmanager-extension\src\index.ts (old)
+++ packages\extensionmanager-extension\src\index.ts (new)
@@ -6,18 +6,15 @@
  */
 
 import {
+  ILabShell,
   ILayoutRestorer,
   JupyterFrontEnd,
   JupyterFrontEndPlugin
 } from '@jupyterlab/application';
 import { Dialog, ICommandPalette, showDialog } from '@jupyterlab/apputils';
-import { ExtensionsPanel, ListModel } from '@jupyterlab/extensionmanager';
+import { ExtensionView } from '@jupyterlab/extensionmanager';
 import { ISettingRegistry } from '@jupyterlab/settingregistry';
-import {
-  ITranslator,
-  nullTranslator,
-  TranslationBundle
-} from '@jupyterlab/translation';
+import { ITranslator, TranslationBundle } from '@jupyterlab/translation';
 import { extensionIcon } from '@jupyterlab/ui-components';
 
 const PLUGIN_ID = '@jupyterlab/extensionmanager-extension:plugin';
@@ -26,7 +23,6 @@
  * IDs of the commands added by this extension.
  */
 namespace CommandIDs {
-  export const showPanel = 'extensionmanager:show-panel';
   export const toggle = 'extensionmanager:toggle';
 }
 
@@ -35,89 +31,69 @@
  */
 const plugin: JupyterFrontEndPlugin<void> = {
   id: PLUGIN_ID,
-  description: 'Adds the extension manager plugin.',
   autoStart: true,
-  requires: [ISettingRegistry],
-  optional: [ITranslator, ILayoutRestorer, ICommandPalette],
+  requires: [ISettingRegistry, ITranslator],
+  optional: [ILabShell, ILayoutRestorer, ICommandPalette],
   activate: async (
     app: JupyterFrontEnd,
     registry: ISettingRegistry,
-    translator: ITranslator | null,
+    translator: ITranslator,
+    labShell: ILabShell | null,
     restorer: ILayoutRestorer | null,
     palette: ICommandPalette | null
   ) => {
-    const { commands, shell, serviceManager } = app;
-    translator = translator ?? nullTranslator;
     const trans = translator.load('jupyterlab');
+    const settings = await registry.load(plugin.id);
+    let enabled = settings.composite['enabled'] === true;
 
-    const model = new ListModel(serviceManager, translator);
+    const { commands, serviceManager } = app;
+    let view: ExtensionView | undefined;
 
     const createView = () => {
-      const v = new ExtensionsPanel({ model, translator: translator! });
+      const v = new ExtensionView(app, serviceManager, settings, translator);
       v.id = 'extensionmanager.main-view';
       v.title.icon = extensionIcon;
       v.title.caption = trans.__('Extension Manager');
-      v.node.setAttribute('role', 'region');
-      v.node.setAttribute('aria-label', trans.__('Extension Manager section'));
       if (restorer) {
         restorer.add(v, v.id);
       }
-      shell.add(v, 'left', { rank: 1000 });
-
       return v;
     };
 
-    // Create a view by default, so it can be restored when loading the workspace.
-    let view: ExtensionsPanel | null = createView();
+    if (enabled && labShell) {
+      view = createView();
+      view.node.setAttribute('role', 'region');
+      view.node.setAttribute(
+        'aria-label',
+        trans.__('Extension Manager section')
+      );
+      labShell.add(view, 'left', { rank: 1000 });
+    }
 
     // If the extension is enabled or disabled,
     // add or remove it from the left area.
     Promise.all([app.restored, registry.load(PLUGIN_ID)])
       .then(([, settings]) => {
-        model.isDisclaimed = settings.get('disclaimed').composite as boolean;
-        model.isEnabled = settings.get('enabled').composite as boolean;
-        model.stateChanged.connect(() => {
-          if (
-            model.isDisclaimed !==
-            (settings.get('disclaimed').composite as boolean)
-          ) {
-            settings.set('disclaimed', model.isDisclaimed).catch(reason => {
-              console.error(`Failed to set setting 'disclaimed'.\n${reason}`);
-            });
-          }
-          if (
-            model.isEnabled !== (settings.get('enabled').composite as boolean)
-          ) {
-            settings.set('enabled', model.isEnabled).catch(reason => {
-              console.error(`Failed to set setting 'enabled'.\n${reason}`);
-            });
-          }
-        });
-
-        if (model.isEnabled) {
-          view = view ?? createView();
-        } else {
-          view?.dispose();
-          view = null;
-        }
-
         settings.changed.connect(async () => {
-          model.isDisclaimed = settings.get('disclaimed').composite as boolean;
-          model.isEnabled = settings.get('enabled').composite as boolean;
-          app.commands.notifyCommandChanged(CommandIDs.toggle);
-
-          if (model.isEnabled) {
-            if (view === null || !view.isAttached) {
-              const accepted = await Private.showWarning(trans);
-              if (!accepted) {
-                void settings.set('enabled', false);
-                return;
-              }
+          enabled = settings.composite['enabled'] === true;
+          if (enabled && !view?.isAttached) {
+            const accepted = await Private.showWarning(trans);
+            if (!accepted) {
+              void settings.set('enabled', false);
+              return;
             }
-            view = view ?? createView();
-          } else {
-            view?.dispose();
-            view = null;
+            view = view || createView();
+            view.node.setAttribute('role', 'region');
+            view.node.setAttribute(
+              'aria-label',
+              trans.__('Extension Manager section')
+            );
+            if (labShell) {
+              labShell.add(view, 'left', { rank: 1000 });
+            }
+          } else if (!enabled && view?.isAttached) {
+            app.commands.notifyCommandChanged(CommandIDs.toggle);
+            view.close();
           }
         });
       })
@@ -127,31 +103,21 @@
         );
       });
 
-    commands.addCommand(CommandIDs.showPanel, {
-      label: trans.__('Extension Manager'),
-      execute: () => {
-        if (view) {
-          shell.activateById(view.id);
-        }
-      },
-      isVisible: () => model.isEnabled
-    });
-
     commands.addCommand(CommandIDs.toggle, {
       label: trans.__('Enable Extension Manager'),
       execute: () => {
         if (registry) {
-          void registry.set(plugin.id, 'enabled', !model.isEnabled);
+          void registry.set(plugin.id, 'enabled', !enabled);
         }
       },
-      isToggled: () => model.isEnabled
+      isToggled: () => enabled,
+      isEnabled: () => serviceManager.builder.isAvailable
     });
 
+    const category = trans.__('Extension Manager');
+    const command = CommandIDs.toggle;
     if (palette) {
-      palette.addItem({
-        command: CommandIDs.toggle,
-        category: trans.__('Extension Manager')
-      });
+      palette.addItem({ command, category });
     }
   }
 };
@@ -173,7 +139,7 @@
   export async function showWarning(
     trans: TranslationBundle
   ): Promise<boolean> {
-    const result = await showDialog({
+    return showDialog({
       title: trans.__('Enable Extension Manager?'),
       body: trans.__(`Thanks for trying out JupyterLab's extension manager.
 The JupyterLab development team is excited to have a robust
@@ -185,8 +151,8 @@
         Dialog.cancelButton({ label: trans.__('Disable') }),
         Dialog.warnButton({ label: trans.__('Enable') })
       ]
+    }).then(result => {
+      return result.button.accept;
     });
-
-    return result.button.accept;
   }
 }