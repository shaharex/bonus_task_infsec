--- docs\source\conf.py (old)
+++ docs\source\conf.py (new)
@@ -1,7 +1,5 @@
 #!/usr/bin/env python3
-# Copyright (c) Jupyter Development Team.
-# Distributed under the terms of the Modified BSD License.
-
+# -*- coding: utf-8 -*-
 #
 # JupyterLab documentation build configuration file, created by
 # sphinx-quickstart on Thu Jan  4 15:10:23 2018.
@@ -23,17 +21,12 @@
 # import sys
 # sys.path.insert(0, os.path.abspath('.'))
 
-import json
 import os
+import os.path as osp
 import shutil
-import time
-from collections import ChainMap
-from functools import partial
-from pathlib import Path
 from subprocess import check_call
-from typing import List
-
-HERE = Path(__file__).parent.resolve()
+
+HERE = osp.abspath(osp.dirname(__file__))
 
 # -- General configuration ------------------------------------------------
 
@@ -44,12 +37,7 @@
 # Add any Sphinx extension module names here, as strings. They can be
 # extensions coming with Sphinx (named 'sphinx.ext.*') or your custom
 # ones.
-extensions = [
-    "myst_parser",
-    "sphinx.ext.intersphinx",
-    "sphinx.ext.mathjax",
-    "sphinx_copybutton",
-]
+extensions = ["myst_parser", "sphinx.ext.intersphinx", "sphinx.ext.mathjax", "sphinx_copybutton"]
 
 myst_enable_extensions = ["html_image"]
 myst_heading_anchors = 3
@@ -67,7 +55,7 @@
 
 # General information about the project.
 project = "JupyterLab"
-copyright = f"2018-{time.localtime().tm_year}, Project Jupyter"  # noqa
+copyright = "2018, Project Jupyter"
 author = "Project Jupyter"
 
 
@@ -75,13 +63,14 @@
 # |version| and |release|, also used in various other places throughout the
 # built documents.
 
-_version_py = HERE.parent.parent / "jupyterlab" / "_version.py"
+_version_py = osp.join(HERE, "..", "..", "jupyterlab", "_version.py")
 version_ns = {}
 
-exec(_version_py.read_text(), version_ns)  # noqa
+with open(_version_py, mode="r") as version_file:
+    exec(version_file.read(), version_ns)
 
 # The short X.Y version.
-version = "{0:d}.{1:d}".format(*version_ns["version_info"])  # noqa
+version = "%i.%i" % version_ns["version_info"][:2]
 # The full version, including alpha/beta/rc tags.
 release = version_ns["__version__"]
 
@@ -90,10 +79,8 @@
 # for a list of supported languages.
 #
 # This is also used if you do content translation via gettext catalogs.
-language = "en"  # Must be set from the command line to generate various languages
-
-locale_dirs = ["locale/"]
-gettext_compact = False
+# Usually you set "language" from the command line for these cases.
+language = "en"
 
 # List of patterns, relative to source directory, that match files and
 # directories to ignore when looking for source files.
@@ -105,132 +92,50 @@
 
 
 # build js docs and stage them to the build directory
-def build_api_docs(out_dir: Path):
+def build_api_docs(out_dir):
     """build js api docs"""
-    docs = HERE.parent
-    root = docs.parent
-    docs_api = docs / "source" / "api"
-    api_index = docs_api / "index.html"
+    docs = osp.join(HERE, os.pardir)
+    root = osp.join(docs, os.pardir)
+    docs_api = osp.join(docs, "api")
+    api_index = osp.join(docs_api, "index.html")
     # is this an okay way to specify jlpm
     # without installing jupyterlab first?
-    jlpm = ["node", str(root / "jupyterlab" / "staging" / "yarn.js")]
-
-    if api_index.exists():
+    jlpm = ["node", osp.join(root, "jupyterlab", "staging", "yarn.js")]
+
+    if osp.exists(api_index):
         # avoid rebuilding docs because it takes forever
         # `make clean` to force a rebuild
-        pass
+        print(f"already have {api_index}")
     else:
-        check_call(jlpm, cwd=str(root))  # noqa S603
-        check_call([*jlpm, "build:packages"], cwd=str(root))  # noqa S603
-        check_call([*jlpm, "docs"], cwd=str(root))  # noqa S603
-
-    dest_dir = out_dir / "api"
-    if dest_dir.exists():
-        shutil.rmtree(str(dest_dir))
-    shutil.copytree(str(docs_api), str(dest_dir))
+        print("Building jupyterlab API docs")
+        check_call(jlpm, cwd=root)
+        check_call(jlpm + ["build:packages"], cwd=root)
+        check_call(jlpm + ["docs"], cwd=root)
+
+    dest_dir = osp.join(out_dir, "api")
+    print(f"Copying {docs_api} -> {dest_dir}")
+    if osp.exists(dest_dir):
+        shutil.rmtree(dest_dir)
+    shutil.copytree(docs_api, dest_dir)
 
 
 # Copy frontend files for snippet inclusion
 FILES_LIST = [  # File paths should be relative to jupyterlab root folder
-    "galata/test/documentation/data/custom-jupyter.css",
-    "galata/test/documentation/data/custom-markdown.css",
-    "packages/settingregistry/src/plugin-schema.json",
+    "packages/settingregistry/src/plugin-schema.json"
 ]
 SNIPPETS_FOLDER = "snippets"
 
 
-def copy_code_files(temp_folder: Path):
+def copy_code_files(temp_folder):
     """Copy files in the temp_folder"""
-    docs = HERE.parent
-    root = docs.parent
+    docs = osp.join(HERE, os.pardir)
+    root = osp.join(docs, os.pardir)
 
     for file in FILES_LIST:
-        target = temp_folder / file
-        if not target.parent.exists():
-            target.parent.mkdir(parents=True, exist_ok=True)
-        shutil.copyfile(str(root / file), str(target))
-
-        # Split plugin schema to ease documentation maintenance
-        if file == "packages/settingregistry/src/plugin-schema.json":
-            schema = json.loads(Path(target).read_text())
-
-            partial_schema = ChainMap(schema.get("definitions", {}), schema.get("properties", {}))
-            for key in partial_schema:
-                fragment = target.parent / f"{key}.json"
-                with fragment.open("w") as f:
-                    json.dump({key: partial_schema[key]}, f, indent=2)
-
-
-IMAGES_FOLDER = "images"
-AUTOMATED_SCREENSHOTS_FOLDER = "galata/test/documentation"
-
-
-def copy_automated_screenshots(temp_folder: Path) -> List[Path]:
-    """Copy PlayWright automated screenshots in documentation folder.
-
-    Args:
-        temp_folder: Target directory in which to copy the file
-    Returns:
-        List of copied files
-    """
-    docs = HERE.parent
-    root = docs.parent
-
-    src = root / AUTOMATED_SCREENSHOTS_FOLDER
-
-    copied_files = []
-    for img in src.rglob("*.png"):
-        target = temp_folder / (img.name.replace("-documentation-linux", ""))
-        shutil.copyfile(str(img), str(target))
-        copied_files.append(target)
-
-    return copied_files
-
-
-COMMANDS_LIST_PATH = "commands.test.ts-snapshots/commandsList-documentation-linux.json"
-COMMANDS_LIST_DOC = "user/commands_list.md"
-PLUGINS_LIST_PATH = "plugins.test.ts-snapshots/plugins-documentation-linux.json"
-PLUGINS_LIST_DOC = "extension/plugins_list.rst"
-TOKENS_LIST_PATH = "plugins.test.ts-snapshots/tokens-documentation-linux.json"
-TOKENS_LIST_DOC = "extension/tokens_list.rst"
-
-
-def document_commands_list(temp_folder: Path) -> None:
-    """Generate the command list documentation page from application extraction."""
-    list_path = HERE.parent.parent / AUTOMATED_SCREENSHOTS_FOLDER / COMMANDS_LIST_PATH
-
-    commands_list = json.loads(list_path.read_text())
-
-    template = """| Command id | Label | Shortcuts |
-| ---------- | ----- | --------- |
-"""
-
-    for command in sorted(commands_list, key=lambda c: c["id"]):
-        for key in ("id", "label", "caption"):
-            if key not in command:
-                command[key] = ""
-            else:
-                command[key] = command[key].replace("\n", " ")
-        shortcuts = command.get("shortcuts", [])
-        command["shortcuts"] = (
-            "<kbd>" + "</kbd>, <kbd>".join(shortcuts) + "</kbd>" if len(shortcuts) else ""
-        )
-
-        template += "| `{id}` | {label} | {shortcuts} |\n".format(**command)
-
-    (temp_folder / COMMANDS_LIST_DOC).write_text(template)
-
-
-def document_plugins_tokens_list(list_path: Path, output_path: Path) -> None:
-    """Generate the plugins list documentation page from application extraction."""
-    items = json.loads(list_path.read_text())
-
-    template = ""
-
-    for _name, _description in items.items():
-        template += f"- ``{_name}``: {_description}\n"
-
-    output_path.write_text(template)
+        target = osp.join(temp_folder, file)
+        if not osp.exists(osp.dirname(target)):
+            os.makedirs(osp.dirname(target), exist_ok=True)
+        shutil.copyfile(osp.join(root, file), target)
 
 
 # -- Options for HTML output ----------------------------------------------
@@ -238,56 +143,16 @@
 # The theme to use for HTML and HTML Help pages.  See the documentation for
 # a list of builtin themes.
 #
-html_theme = "pydata_sphinx_theme"
-html_logo = "_static/logo-rectangle.svg"
-html_favicon = "_static/logo-icon.png"
+import sphinx_rtd_theme
+
+html_theme = "sphinx_rtd_theme"
+html_theme_path = [sphinx_rtd_theme.get_html_theme_path()]
+
 # Theme options are theme-specific and customize the look and feel of a theme
 # further.  For a list of options available for each theme, see the
 # documentation.
 #
-html_theme_options = {
-    "icon_links": [
-        {
-            "name": "jupyter.org",
-            "url": "https://jupyter.org",
-            "icon": "_static/jupyter_logo.svg",
-            "type": "local",
-        },
-        {
-            "name": "GitHub",
-            "url": "https://github.com/jupyterlab/jupyterlab",
-            "icon": "fab fa-github-square",
-        },
-        {
-            "name": "Discourse",
-            "url": "https://discourse.jupyter.org/c/jupyterlab/17",
-            "icon": "fab fa-discourse",
-        },
-        {
-            "name": "Gitter",
-            "url": "https://gitter.im/jupyterlab/jupyterlab",
-            "icon": "fab fa-gitter",
-        },
-    ],
-    "logo": {
-        "image_light": "_static/logo-rectangle.svg",
-        "image_dark": "_static/logo-rectangle-dark.svg",
-        "alt_text": "JupyterLab",
-    },
-    "use_edit_page_button": True,
-    "navbar_align": "left",
-    "navbar_start": ["navbar-logo", "version-switcher"],
-    "navigation_with_keys": False,
-    "footer_start": ["copyright.html"],
-    "switcher": {
-        # Trick to get the documentation version switcher to always points to the latest version without being corrected by the integrity check;
-        # otherwise older versions won't list newer versions
-        "json_url": "/".join(
-            ("https://jupyterlab.readthedocs.io/en", "latest", "_static/switcher.json")
-        ),
-        "version_match": os.environ.get("READTHEDOCS_VERSION", "latest"),
-    },
-}
+# html_theme_options = {}
 
 # Add any paths that contain custom static files (such as style sheets) here,
 # relative to this directory. They are copied after the builtin static files,
@@ -300,16 +165,22 @@
 # This is required for the alabaster theme
 # refs: http://alabaster.readthedocs.io/en/latest/installation.html#sidebars
 html_sidebars = {
-    "index": [],  # Home page has no sidebar so there's more room for content
-    "**": ["sidebar-nav-bs.html"],
+    "**": [
+        "about.html",
+        "navigation.html",
+        "relations.html",  # needs 'show_related': True theme option to display
+        "searchbox.html",
+        "donate.html",
+    ]
 }
 
 # Output for github to be used in links
 html_context = {
+    "display_github": True,  # Integrate GitHub
     "github_user": "jupyterlab",  # Username
     "github_repo": "jupyterlab",  # Repo name
-    "github_version": "4.2.x",  # Version
-    "doc_path": "docs/source/",  # Path in the checkout to the docs root
+    "github_version": "3.6.x",  # Version
+    "conf_py_path": "/docs/source/",  # Path in the checkout to the docs root
 }
 
 # -- Options for HTMLHelp output ------------------------------------------
@@ -339,13 +210,7 @@
 # (source start file, target name, title,
 #  author, documentclass [howto, manual, or own class]).
 latex_documents = [
-    (
-        master_doc,
-        "JupyterLab.tex",
-        "JupyterLab Documentation",
-        "Project Jupyter",
-        "manual",
-    ),
+    (master_doc, "JupyterLab.tex", "JupyterLab Documentation", "Project Jupyter", "manual"),
 ]
 
 
@@ -396,40 +261,22 @@
 
 
 # Example configuration for intersphinx: refer to the Python standard library.
-intersphinx_mapping = {"python": ("https://docs.python.org/3", None)}
+intersphinx_mapping = {'python': ('https://docs.python.org/3', None)}
 
 
 def setup(app):
-    dest = HERE / "getting_started/changelog.md"
-    shutil.copy(str(HERE.parent.parent / "CHANGELOG.md"), str(dest))
+    dest = osp.join(HERE, "getting_started/changelog.md")
+    shutil.copy(osp.join(HERE, "..", "..", "CHANGELOG.md"), dest)
     app.add_css_file("css/custom.css")  # may also be an URL
-    # Skip we are dealing with internationalization
-    outdir = Path(app.outdir)
-    if outdir.name != "gettext":
-        build_api_docs(outdir)
-
-    copy_code_files(Path(app.srcdir) / SNIPPETS_FOLDER)
-    tmp_files = copy_automated_screenshots(Path(app.srcdir) / IMAGES_FOLDER)
-
-    def clean_code_files(tmp_files, app, exception):
+    build_api_docs(app.outdir)
+
+    copy_code_files(osp.join(app.srcdir, SNIPPETS_FOLDER))
+
+    def clean_code_files(app, exception):
         """Remove temporary folder."""
         try:
-            shutil.rmtree(str(Path(app.srcdir) / SNIPPETS_FOLDER))
-        except Exception:  # noqa S110
-            pass
-
-        for f in tmp_files:
-            f.unlink()
-
-    src_dir = Path(app.srcdir)
-    document_commands_list(src_dir)
-    document_plugins_tokens_list(
-        HERE.parent.parent / AUTOMATED_SCREENSHOTS_FOLDER / PLUGINS_LIST_PATH,
-        src_dir / PLUGINS_LIST_DOC,
-    )
-    document_plugins_tokens_list(
-        HERE.parent.parent / AUTOMATED_SCREENSHOTS_FOLDER / TOKENS_LIST_PATH,
-        src_dir / TOKENS_LIST_DOC,
-    )
-
-    app.connect("build-finished", partial(clean_code_files, tmp_files))
+            shutil.rmtree(osp.join(app.srcdir, SNIPPETS_FOLDER))
+        except Exception as e:
+            print(f"Fail to remove temporary snippet folder: {e}")
+
+    app.connect("build-finished", clean_code_files)